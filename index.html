<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0f0f13">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Expense Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ‚îÄ‚îÄ TOKENS ‚îÄ‚îÄ */
    :root {
      --bg:#0f0f13; --bg2:#16161d; --bg3:#1e1e28;
      --card:#1a1a24; --card2:#22222f; --border:#2a2a3a;
      --text:#f0f0f8; --text2:#9090a8; --text3:#5a5a70;
      --accent:#6c63ff; --accent2:#a78bfa;
      --green:#10d98c; --green2:#059669;
      --red:#ff5c7c; --red2:#dc2626;
      --yellow:#fbbf24; --blue:#38bdf8;
      --pink:#f472b6; --orange:#fb923c;
      --radius:20px; --radius-sm:12px;
      --shadow:0 8px 32px rgba(0,0,0,.35);
      --nav-h:72px;
    }
    .light {
      --bg:#f0f0f7; --bg2:#e8e8f0; --bg3:#dddde8;
      --card:#ffffff; --card2:#f5f5fc; --border:#dcdce8;
      --text:#111118; --text2:#555568; --text3:#9090a8;
      --shadow:0 8px 32px rgba(0,0,0,.10);
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    html{scroll-behavior:smooth;}
    body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);transition:background .3s,color .3s;overflow-x:hidden;}
    ::-webkit-scrollbar{width:5px;}
    ::-webkit-scrollbar-track{background:var(--bg2);}
    ::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}
    button{cursor:pointer;border:none;font-family:inherit;}
    input,select{font-family:inherit;outline:none;}

    /* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
    .auth-wrap{
      min-height:100vh;display:flex;align-items:stretch;
      background:var(--bg);position:relative;overflow:hidden;
    }
    /* animated gradient bg */
    .auth-bg{
      position:absolute;inset:0;z-index:0;
      background:linear-gradient(135deg,#0f0f13 0%,#1a1228 40%,#0f1d35 70%,#071a10 100%);
      background-size:400% 400%;
      animation:gradShift 10s ease infinite;
    }
    .light .auth-bg{background:linear-gradient(135deg,#f0f0f7,#e8e0f8,#dbeafe,#d1fae5);background-size:400% 400%;animation:gradShift 10s ease infinite;}
    @keyframes gradShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
    /* floating blobs */
    .blob{position:absolute;border-radius:50%;filter:blur(100px);opacity:.18;animation:blobFloat 8s ease-in-out infinite;pointer-events:none;}
    .blob1{width:420px;height:420px;background:var(--accent);top:-120px;left:-120px;animation-delay:0s;}
    .blob2{width:300px;height:300px;background:var(--green);bottom:-80px;right:-80px;animation-delay:-3s;}
    .blob3{width:200px;height:200px;background:var(--pink);top:40%;left:30%;animation-delay:-6s;}
    @keyframes blobFloat{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-30px) scale(1.05)}}

    .auth-left{
      flex:1;display:flex;align-items:center;justify-content:center;
      padding:48px;position:relative;z-index:1;
    }
    .auth-left-inner{max-width:380px;animation:slideUp .6s ease;}
    .auth-brand{display:flex;align-items:center;gap:14px;margin-bottom:48px;}
    .auth-brand-icon{
      width:56px;height:56px;border-radius:18px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      display:flex;align-items:center;justify-content:center;font-size:26px;
      box-shadow:0 8px 24px rgba(108,99,255,.4);
    }
    .auth-brand-name{font-size:20px;font-weight:800;letter-spacing:-.3px;}
    .auth-brand-sub{font-size:12px;color:var(--text3);}
    .auth-headline{font-size:36px;font-weight:800;line-height:1.2;margin-bottom:12px;letter-spacing:-.5px;}
    .auth-headline span{background:linear-gradient(135deg,var(--accent2),var(--green));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .auth-tagline{font-size:15px;color:var(--text2);margin-bottom:40px;line-height:1.6;}
    .features-list{display:flex;flex-direction:column;gap:14px;}
    .feature-item{display:flex;align-items:center;gap:14px;}
    .feature-dot{
      width:38px;height:38px;border-radius:11px;flex-shrink:0;
      display:flex;align-items:center;justify-content:center;font-size:17px;
    }
    .feature-text{font-size:13px;color:var(--text2);font-weight:500;}
    .feature-text strong{color:var(--text);font-weight:700;}

    .auth-right{
      width:460px;display:flex;align-items:center;justify-content:center;
      padding:40px;position:relative;z-index:1;
    }
    .auth-card{
      background:rgba(26,26,36,.85);backdrop-filter:blur(20px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:28px;padding:44px;width:100%;
      box-shadow:0 32px 80px rgba(0,0,0,.5);
      animation:slideUp .5s ease .1s both;
    }
    .light .auth-card{background:rgba(255,255,255,.92);}
    @keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
    .auth-card-title{font-size:24px;font-weight:800;margin-bottom:4px;}
    .auth-card-sub{font-size:13px;color:var(--text2);margin-bottom:28px;}
    .form-group{margin-bottom:16px;}
    .form-label{display:block;font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;margin-bottom:7px;}
    .form-input{
      width:100%;background:var(--bg2);border:1.5px solid var(--border);
      border-radius:12px;padding:13px 16px;color:var(--text);font-size:15px;
      transition:all .2s;
    }
    .form-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(108,99,255,.12);}
    .form-input::placeholder{color:var(--text3);}
    .btn-auth{
      width:100%;padding:14px;border-radius:13px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:white;font-size:15px;font-weight:700;
      box-shadow:0 8px 24px rgba(108,99,255,.35);
      transition:all .2s;margin-top:4px;
    }
    .btn-auth:hover{transform:translateY(-2px);box-shadow:0 14px 32px rgba(108,99,255,.45);}
    .btn-auth:disabled{opacity:.6;transform:none;}
    .auth-switch{text-align:center;margin-top:20px;font-size:13px;color:var(--text2);}
    .auth-switch a{color:var(--accent2);cursor:pointer;font-weight:700;}
    .err-box{background:rgba(255,92,124,.1);border:1px solid rgba(255,92,124,.25);color:var(--red);padding:11px 14px;border-radius:10px;font-size:13px;margin-bottom:14px;}

    /* ‚îÄ‚îÄ APP LAYOUT ‚îÄ‚îÄ */
    .app-wrap{display:flex;min-height:100vh;}

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar{
      width:248px;background:var(--card);border-right:1px solid var(--border);
      display:flex;flex-direction:column;padding:28px 16px;
      position:fixed;height:100vh;z-index:200;
      transition:transform .3s cubic-bezier(.4,0,.2,1);
    }
    .sidebar-logo{display:flex;align-items:center;gap:12px;padding:8px 12px;margin-bottom:36px;}
    .sidebar-logo-icon{
      width:44px;height:44px;border-radius:14px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      display:flex;align-items:center;justify-content:center;font-size:21px;
      box-shadow:0 4px 16px rgba(108,99,255,.35);
      transition:transform .3s;
    }
    .sidebar-logo:hover .sidebar-logo-icon{transform:rotate(-8deg) scale(1.05);}
    .sidebar-logo-name{font-size:15px;font-weight:800;}
    .sidebar-logo-sub{font-size:10px;color:var(--text3);letter-spacing:.3px;}
    .nav-section-label{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;padding:0 14px;margin-bottom:6px;}
    .nav-item{
      display:flex;align-items:center;gap:13px;
      padding:12px 14px;border-radius:var(--radius-sm);
      color:var(--text2);font-size:14px;font-weight:500;
      margin-bottom:2px;width:100%;text-align:left;
      background:transparent;transition:all .2s;
      position:relative;overflow:hidden;
    }
    .nav-item::before{
      content:'';position:absolute;inset:0;border-radius:var(--radius-sm);
      background:linear-gradient(135deg,rgba(108,99,255,.12),rgba(167,139,250,.06));
      opacity:0;transition:opacity .2s;
    }
    .nav-item:hover{color:var(--text);transform:translateX(3px);}
    .nav-item:hover::before{opacity:1;}
    .nav-item.active{
      color:var(--accent2);font-weight:700;
      background:linear-gradient(135deg,rgba(108,99,255,.14),rgba(167,139,250,.07));
      border:1px solid rgba(108,99,255,.18);
      box-shadow:0 4px 16px rgba(108,99,255,.1);
    }
    .nav-item.active::before{opacity:0;}
    /* animated left bar */
    .nav-item.active::after{
      content:'';position:absolute;left:0;top:20%;bottom:20%;
      width:3px;background:linear-gradient(180deg,var(--accent),var(--accent2));
      border-radius:2px;animation:barSlide .3s ease;
    }
    @keyframes barSlide{from{opacity:0;height:0;top:50%}to{opacity:1;}}
    .nav-icon{width:22px;text-align:center;font-size:17px;transition:transform .2s;}
    .nav-item:hover .nav-icon{transform:scale(1.15);}
    .nav-item.active .nav-icon{filter:drop-shadow(0 0 6px rgba(167,139,250,.5));}
    .sidebar-spacer{flex:1;}
    .sidebar-user{
      background:var(--bg2);border-radius:16px;padding:14px;
      display:flex;align-items:center;gap:11px;margin-bottom:10px;
      border:1px solid var(--border);
    }
    .user-avatar{
      width:40px;height:40px;border-radius:13px;
      background:linear-gradient(135deg,var(--accent),var(--pink));
      display:flex;align-items:center;justify-content:center;
      font-size:15px;font-weight:800;color:white;flex-shrink:0;
      box-shadow:0 3px 10px rgba(108,99,255,.3);
    }
    .user-name{font-size:13px;font-weight:700;}
    .user-email{font-size:11px;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:130px;}
    .btn-logout{
      width:100%;padding:10px;border-radius:11px;
      background:rgba(255,92,124,.08);border:1px solid rgba(255,92,124,.18);
      color:var(--red);font-size:13px;font-weight:600;
      transition:all .2s;
    }
    .btn-logout:hover{background:rgba(255,92,124,.16);transform:translateY(-1px);}

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    .main{flex:1;margin-left:248px;display:flex;flex-direction:column;min-height:100vh;}

    /* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
    .topbar{
      background:var(--card);border-bottom:1px solid var(--border);
      padding:18px 36px;display:flex;align-items:center;justify-content:space-between;
      position:sticky;top:0;z-index:100;
    }
    .topbar-greet{font-size:21px;font-weight:800;letter-spacing:-.3px;}
    .topbar-date{font-size:12px;color:var(--text3);margin-top:2px;}
    .topbar-right{display:flex;align-items:center;gap:10px;}
    .icon-btn{
      width:42px;height:42px;background:var(--bg2);
      border:1px solid var(--border);border-radius:13px;
      display:flex;align-items:center;justify-content:center;
      font-size:18px;cursor:pointer;transition:all .2s;position:relative;
    }
    .icon-btn:hover{background:var(--bg3);transform:scale(1.05);}
    .notif-dot{width:8px;height:8px;background:var(--red);border-radius:50%;position:absolute;top:8px;right:8px;border:2px solid var(--card);}

    /* ‚îÄ‚îÄ PAGE ‚îÄ‚îÄ */
    .page{padding:36px;padding-bottom:calc(36px + env(safe-area-inset-bottom));}
    .page-head{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:32px;gap:16px;}
    .page-title{font-size:26px;font-weight:800;letter-spacing:-.4px;}
    .page-sub{font-size:13px;color:var(--text3);margin-top:4px;}

    /* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
    .stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:22px;margin-bottom:32px;}
    .stat-card{
      border-radius:var(--radius);padding:26px;
      position:relative;overflow:hidden;
      animation:cardIn .4s ease both;
      transition:transform .2s,box-shadow .2s;
    }
    .stat-card:hover{transform:translateY(-3px);box-shadow:var(--shadow);}
    @keyframes cardIn{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
    .sc-income{background:linear-gradient(135deg,#0c2233,#0a1822);border:1px solid rgba(56,189,248,.22);}
    .sc-expense{background:linear-gradient(135deg,#20101a,#160b14);border:1px solid rgba(255,92,124,.22);}
    .sc-balance{background:linear-gradient(135deg,#0a1f15,#06150f);border:1px solid rgba(16,217,140,.22);}
    .light .sc-income{background:linear-gradient(135deg,#dbeafe,#eff6ff);}
    .light .sc-expense{background:linear-gradient(135deg,#ffe4e6,#fff1f2);}
    .light .sc-balance{background:linear-gradient(135deg,#d1fae5,#ecfdf5);}
    .sc-glow{position:absolute;width:140px;height:140px;border-radius:50%;top:-40px;right:-40px;opacity:.07;pointer-events:none;}
    .sc-income .sc-glow{background:var(--blue);}
    .sc-expense .sc-glow{background:var(--red);}
    .sc-balance .sc-glow{background:var(--green);}
    .sc-icon{width:50px;height:50px;border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:18px;}
    .sc-income .sc-icon{background:rgba(56,189,248,.14);}
    .sc-expense .sc-icon{background:rgba(255,92,124,.14);}
    .sc-balance .sc-icon{background:rgba(16,217,140,.14);}
    .sc-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;margin-bottom:6px;}
    .sc-income .sc-label{color:rgba(56,189,248,.7);}
    .sc-expense .sc-label{color:rgba(255,92,124,.7);}
    .sc-balance .sc-label{color:rgba(16,217,140,.7);}
    .sc-value{font-size:30px;font-weight:800;line-height:1;margin-bottom:10px;letter-spacing:-.5px;}
    .sc-income .sc-value{color:var(--blue);}
    .sc-expense .sc-value{color:var(--red);}
    .sc-balance .sc-value{color:var(--green);}
    .sc-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:8px;font-size:11px;font-weight:600;}

    /* ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ */
    .charts-row{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:32px;}
    .chart-card{
      background:var(--card);border:1px solid var(--border);
      border-radius:var(--radius);padding:28px;
      animation:cardIn .5s ease .1s both;
      transition:box-shadow .2s;
    }
    .chart-card:hover{box-shadow:var(--shadow);}
    .chart-card-title{font-size:15px;font-weight:700;margin-bottom:3px;}
    .chart-card-sub{font-size:12px;color:var(--text3);margin-bottom:22px;}
    .chart-divider{height:1px;background:var(--border);margin:0 -28px 22px;}
    .chart-area{position:relative;height:240px;}

    /* ‚îÄ‚îÄ BOTTOM GRID ‚îÄ‚îÄ */
    .bottom-row{display:grid;grid-template-columns:1fr 1fr;gap:24px;}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:26px;animation:cardIn .5s ease .2s both;}
    .panel-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;}
    .panel-title{font-size:15px;font-weight:700;}
    .panel-action{font-size:12px;color:var(--accent2);cursor:pointer;font-weight:600;transition:opacity .2s;}
    .panel-action:hover{opacity:.7;}

    /* ‚îÄ‚îÄ TXN LIST ‚îÄ‚îÄ */
    .txn{display:flex;align-items:center;gap:14px;padding:14px 0;border-bottom:1px solid var(--border);transition:padding .15s;}
    .txn:last-child{border:none;padding-bottom:0;}
    .txn:hover{padding-left:6px;}
    .txn-ico{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0;}
    .txn-info{flex:1;min-width:0;}
    .txn-name{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .txn-meta{font-size:11px;color:var(--text3);margin-top:2px;}
    .txn-right{text-align:right;flex-shrink:0;}
    .txn-amt{font-size:15px;font-weight:800;}
    .txn-tag{font-size:10px;font-weight:700;padding:2px 8px;border-radius:6px;margin-top:4px;display:inline-block;text-transform:uppercase;letter-spacing:.3px;}

    /* ‚îÄ‚îÄ BUDGET ‚îÄ‚îÄ */
    .budget-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .budget-label{font-size:13px;font-weight:600;color:var(--text2);display:flex;align-items:center;gap:8px;}
    .budget-val{font-size:15px;font-weight:800;}
    .prog-bg{height:7px;background:var(--bg2);border-radius:8px;overflow:hidden;margin-bottom:20px;}
    .prog-fill{height:100%;border-radius:8px;transition:width 1.2s cubic-bezier(.4,0,.2,1);}

    /* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
    .form-panel{
      background:var(--card);border:1px solid var(--border);
      border-radius:var(--radius);padding:30px;margin-bottom:26px;
      animation:slideDown .3s ease;
    }
    @keyframes slideDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
    .form-panel-title{font-size:17px;font-weight:800;margin-bottom:24px;}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;}
    .fg{display:flex;flex-direction:column;gap:7px;}
    .flabel{font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;}
    .finput{
      background:var(--bg2);border:1.5px solid var(--border);
      border-radius:var(--radius-sm);padding:13px 15px;
      color:var(--text);font-size:14px;width:100%;transition:all .2s;
    }
    .finput:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(108,99,255,.1);}
    .finput::placeholder{color:var(--text3);}
    .form-btns{display:flex;gap:12px;margin-top:22px;}
    .sbtn{padding:13px 28px;border-radius:var(--radius-sm);font-size:14px;font-weight:700;transition:all .2s;cursor:pointer;border:none;font-family:inherit;}
    .sbtn-blue{background:linear-gradient(135deg,#1d4ed8,var(--accent));color:white;box-shadow:0 6px 18px rgba(108,99,255,.28);}
    .sbtn-blue:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(108,99,255,.38);}
    .sbtn-green{background:linear-gradient(135deg,var(--green2),#10d98c);color:white;box-shadow:0 6px 18px rgba(16,217,140,.25);}
    .sbtn-green:hover{transform:translateY(-2px);}
    .sbtn-cancel{background:var(--bg2);border:1px solid var(--border);color:var(--text2);}
    .sbtn-cancel:hover{background:var(--bg3);}
    .add-btn{
      display:flex;align-items:center;gap:8px;
      padding:12px 22px;border-radius:var(--radius-sm);
      font-size:14px;font-weight:700;
      transition:all .2s;flex-shrink:0;
    }
    .add-btn:hover{transform:translateY(-2px);}
    .add-green{background:linear-gradient(135deg,var(--green2),#10d98c);color:white;box-shadow:0 6px 18px rgba(16,217,140,.28);}
    .add-blue{background:linear-gradient(135deg,#1d4ed8,var(--accent));color:white;box-shadow:0 6px 18px rgba(108,99,255,.28);}
    .add-purple{background:linear-gradient(135deg,#7c3aed,var(--accent2));color:white;box-shadow:0 6px 18px rgba(124,58,237,.28);}

    /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
    .tbl-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:cardIn .4s ease;}
    .tbl-filters{display:flex;gap:12px;padding:16px 24px;border-bottom:1px solid var(--border);background:var(--bg2);}
    .fsel{background:var(--card);border:1.5px solid var(--border);border-radius:10px;padding:8px 14px;color:var(--text);font-size:13px;font-weight:600;cursor:pointer;outline:none;}
    table{width:100%;border-collapse:collapse;}
    thead tr{background:var(--bg2);}
    th{padding:12px 22px;text-align:left;font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;white-space:nowrap;}
    td{padding:15px 22px;font-size:14px;border-bottom:1px solid var(--border);}
    tbody tr:last-child td{border-bottom:none;}
    tbody tr:hover{background:var(--bg2);}
    .pill{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:8px;font-size:12px;font-weight:600;}
    .act-btn{padding:6px 13px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .15s;border:none;}
    .act-edit{background:rgba(108,99,255,.1);color:var(--accent2);margin-right:6px;}
    .act-edit:hover{background:rgba(108,99,255,.2);}
    .act-del{background:rgba(255,92,124,.1);color:var(--red);}
    .act-del:hover{background:rgba(255,92,124,.2);}
    .empty{text-align:center;padding:60px 20px;}
    .empty-ico{font-size:44px;margin-bottom:12px;}
    .empty-txt{font-size:15px;font-weight:700;color:var(--text2);margin-bottom:4px;}
    .empty-sub{font-size:13px;color:var(--text3);}

    /* ‚îÄ‚îÄ CATEGORIES ‚îÄ‚îÄ */
    .cat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;}
    .cat-card{
      background:var(--card);border:1px solid var(--border);
      border-radius:var(--radius);padding:22px;
      display:flex;align-items:center;gap:14px;
      transition:all .2s;animation:cardIn .4s ease;
    }
    .cat-card:hover{transform:translateY(-3px);box-shadow:var(--shadow);}
    .cat-ico-big{width:54px;height:54px;border-radius:17px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;}
    .cat-name{font-size:15px;font-weight:700;margin-bottom:3px;}
    .cat-hex{font-size:11px;color:var(--text3);}

    /* ‚îÄ‚îÄ STATS PAGE ‚îÄ‚îÄ */
    .stats-mini-row{display:grid;grid-template-columns:repeat(4,1fr);gap:18px;margin-bottom:28px;}
    .stat-mini{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px;animation:cardIn .4s ease;}
    .stat-mini-label{font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;margin-bottom:8px;}
    .stat-mini-val{font-size:26px;font-weight:800;}
    .breakdown-item{display:flex;align-items:center;gap:13px;padding:14px 0;border-bottom:1px solid var(--border);}
    .breakdown-item:last-child{border:none;}
    .bk-ico{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
    .bk-name{font-size:13px;font-weight:700;margin-bottom:5px;}
    .bk-bar-bg{height:4px;background:var(--bg2);border-radius:4px;overflow:hidden;}
    .bk-bar{height:100%;border-radius:4px;transition:width 1.2s cubic-bezier(.4,0,.2,1);}
    .bk-right{text-align:right;min-width:80px;}
    .bk-amt{font-size:14px;font-weight:800;}
    .bk-pct{font-size:11px;color:var(--text3);}

    /* ‚îÄ‚îÄ MOBILE BOTTOM NAV ‚îÄ‚îÄ */
    .bottom-nav{
      display:none;
      position:fixed;bottom:0;left:0;right:0;
      height:var(--nav-h);
      background:var(--card);
      border-top:1px solid var(--border);
      z-index:300;
      padding:0 8px;
      padding-bottom:env(safe-area-inset-bottom);
      backdrop-filter:blur(16px);
      box-shadow:0 -8px 32px rgba(0,0,0,.25);
    }
    .bottom-nav-inner{
      display:flex;align-items:center;justify-content:space-around;
      height:60px;
    }
    .bn-item{
      display:flex;flex-direction:column;align-items:center;gap:4px;
      padding:8px 14px;border-radius:var(--radius-sm);
      cursor:pointer;transition:all .2s;
      color:var(--text3);font-size:10px;font-weight:600;
      min-width:56px;text-align:center;border:none;background:none;
      font-family:inherit;
    }
    .bn-item.active{color:var(--accent2);}
    .bn-ico-wrap{
      width:36px;height:36px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      font-size:19px;transition:all .25s;
    }
    .bn-item.active .bn-ico-wrap{
      background:linear-gradient(135deg,rgba(108,99,255,.18),rgba(167,139,250,.1));
      box-shadow:0 3px 12px rgba(108,99,255,.2);
      transform:translateY(-2px) scale(1.08);
    }
    .bn-label{transition:color .2s;letter-spacing:.2px;}
    .bn-item.active .bn-label{color:var(--accent2);}

    /* mobile topbar has hamburger-less design */
    .mobile-topbar{
      display:none;
      background:var(--card);border-bottom:1px solid var(--border);
      padding:14px 20px;align-items:center;justify-content:space-between;
      position:sticky;top:0;z-index:100;
    }
    .mobile-logo{display:flex;align-items:center;gap:10px;}
    .mobile-logo-ico{width:36px;height:36px;border-radius:11px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:17px;}
    .mobile-logo-name{font-size:16px;font-weight:800;}

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media(max-width:900px){
      .sidebar{display:none;}
      .main{margin-left:0;padding-bottom:var(--nav-h);}
      .topbar{display:none;}
      .mobile-topbar{display:flex;}
      .bottom-nav{display:block;}
      .stats-row{grid-template-columns:1fr;gap:14px;}
      .charts-row,.bottom-row{grid-template-columns:1fr;gap:16px;}
      .cat-grid{grid-template-columns:1fr 1fr;}
      .form-grid{grid-template-columns:1fr;}
      .page{padding:20px 16px;padding-bottom:calc(var(--nav-h) + 20px);}
      .page-head{flex-direction:column;align-items:flex-start;gap:12px;}
      .stats-mini-row{grid-template-columns:1fr 1fr;}
      .stat-card{padding:20px;}
      .sc-value{font-size:24px;}
      .auth-left{display:none;}
      .auth-right{width:100%;padding:24px;}
      .auth-card{padding:32px 24px;}
      tbl-filters{flex-wrap:wrap;}
    }
    @media(max-width:500px){
      .cat-grid{grid-template-columns:1fr;}
      .stats-mini-row{grid-template-columns:1fr 1fr;}
      .charts-row{gap:14px;}
    }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef} = React;
const SURL='https://lspjxjmbzgxtthpahfro.supabase.co';
const SKEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzcGp4am1iemd4dHRocGFoZnJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNDI4NDQsImV4cCI6MjA4NjgxODg0NH0.jF1tjzP0qtcCqlCTyUx1jCL7LTuNW_gKJ1oPJJsvixE';
const sb=window.supabase.createClient(SURL,SKEY);

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
function Auth({onOK}){
  const[isLogin,setL]=useState(true);
  const[email,setE]=useState('');const[pass,setP]=useState('');const[name,setN]=useState('');
  const[loading,setLd]=useState(false);const[err,setErr]=useState('');
  const go=async(e)=>{
    e.preventDefault();setErr('');setLd(true);
    try{
      if(isLogin){const{data,error}=await sb.auth.signInWithPassword({email,password:pass});if(error)throw error;onOK(data.user);}
      else{const{data,error}=await sb.auth.signUp({email,password:pass});if(error)throw error;if(data.user){await sb.from('profiles').insert({id:data.user.id,email,full_name:name});onOK(data.user);}}
    }catch(e){setErr(e.message);}finally{setLd(false);}
  };
  const features=[
    {ico:'üìä',bg:'rgba(108,99,255,.15)',title:'Visual Analytics',desc:'Beautiful charts & spending insights'},
    {ico:'üîí',bg:'rgba(16,217,140,.15)',title:'Secure & Private',desc:'Your data protected with Row Level Security'},
    {ico:'üì±',bg:'rgba(56,189,248,.15)',title:'Works Everywhere',desc:'Mobile-first, app-like experience'},
  ];
  return(
    <div className="auth-wrap">
      <div className="auth-bg"></div>
      <div className="blob blob1"></div><div className="blob blob2"></div><div className="blob blob3"></div>
      <div className="auth-left">
        <div className="auth-left-inner">
          <div className="auth-brand">
            <div className="auth-brand-icon">üí∞</div>
            <div><div className="auth-brand-name">Expense Manager</div><div className="auth-brand-sub">Personal Finance Tracker</div></div>
          </div>
          <div className="auth-headline">Take control of your <span>money</span> today</div>
          <div className="auth-tagline">Track income, manage expenses, and gain insights into your spending habits with beautiful visualisations.</div>
          <div className="features-list">
            {features.map((f,i)=>(
              <div key={i} className="feature-item">
                <div className="feature-dot" style={{background:f.bg}}>{f.ico}</div>
                <div className="feature-text"><strong>{f.title}</strong> ‚Äî {f.desc}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
      <div className="auth-right">
        <div className="auth-card">
          <div className="auth-card-title">{isLogin?'Welcome back üëã':'Create account ‚ú®'}</div>
          <div className="auth-card-sub">{isLogin?'Sign in to access your dashboard':'Start tracking your finances for free'}</div>
          <form onSubmit={go}>
            {!isLogin&&<div className="form-group"><label className="form-label">Full Name</label><input className="form-input" type="text" placeholder="Your name" value={name} onChange={e=>setN(e.target.value)} required/></div>}
            <div className="form-group"><label className="form-label">Email</label><input className="form-input" type="email" placeholder="you@example.com" value={email} onChange={e=>setE(e.target.value)} required/></div>
            <div className="form-group"><label className="form-label">Password</label><input className="form-input" type="password" placeholder="Min 6 characters" value={pass} onChange={e=>setP(e.target.value)} required minLength={6}/></div>
            {err&&<div className="err-box">‚ö†Ô∏è {err}</div>}
            <button className="btn-auth" type="submit" disabled={loading}>{loading?'‚è≥ Please wait‚Ä¶':isLogin?'‚Üí Sign In':'‚Üí Create Account'}</button>
          </form>
          <div className="auth-switch">{isLogin?"Don't have an account? ":"Already have an account? "}<a onClick={()=>setL(!isLogin)}>{isLogin?'Sign Up':'Sign In'}</a></div>
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
function Dashboard({expenses,income,dark,goTab}){
  const lRef=useRef(),bRef=useRef(),pRef=useRef();
  const lI=useRef(),bI=useRef(),pI=useRef();
  const totalInc=income.reduce((s,i)=>s+parseFloat(i.amount),0);
  const totalExp=expenses.reduce((s,e)=>s+parseFloat(e.amount),0);
  const bal=totalInc-totalExp;
  const now=new Date();
  const mE=expenses.filter(e=>{const d=new Date(e.date);return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();});
  const mI=income.filter(i=>{const d=new Date(i.date);return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();});
  const mET=mE.reduce((s,e)=>s+parseFloat(e.amount),0);
  const mIT=mI.reduce((s,i)=>s+parseFloat(i.amount),0);
  const gc=dark?'rgba(255,255,255,.05)':'rgba(0,0,0,.06)';

  const makeMonths=(n=7)=>{const a=[];for(let i=n-1;i>=0;i--){const d=new Date();d.setMonth(d.getMonth()-i);a.push(d);}return a;};

  useEffect(()=>{
    if(!lRef.current)return;
    if(lI.current)lI.current.destroy();
    const ms=makeMonths(7);
    const labels=ms.map(d=>d.toLocaleString('default',{month:'short'}));
    const eD=ms.map(d=>expenses.filter(e=>{const ed=new Date(e.date);return ed.getMonth()===d.getMonth()&&ed.getFullYear()===d.getFullYear();}).reduce((s,e)=>s+parseFloat(e.amount),0));
    const iD=ms.map(d=>income.filter(i=>{const id=new Date(i.date);return id.getMonth()===d.getMonth()&&id.getFullYear()===d.getFullYear();}).reduce((s,i)=>s+parseFloat(i.amount),0));
    lI.current=new Chart(lRef.current,{type:'line',data:{labels,datasets:[{label:'Income',data:iD,borderColor:'#10d98c',backgroundColor:'rgba(16,217,140,.07)',tension:.4,borderWidth:2.5,pointRadius:4,pointBackgroundColor:'#10d98c'},{label:'Expenses',data:eD,borderColor:'#ff5c7c',backgroundColor:'rgba(255,92,124,.07)',tension:.4,borderWidth:2.5,pointRadius:4,pointBackgroundColor:'#ff5c7c'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:true,position:'top',labels:{boxWidth:10,padding:14,font:{size:11},color:dark?'#9090a8':'#555568'}}},scales:{x:{grid:{color:gc},ticks:{font:{size:10},color:dark?'#9090a8':'#555568'}},y:{grid:{color:gc},beginAtZero:true,ticks:{font:{size:10},color:dark?'#9090a8':'#555568'}}}}});
    return()=>{if(lI.current)lI.current.destroy();};
  },[expenses,income,dark]);

  useEffect(()=>{
    if(!pRef.current||expenses.length===0)return;
    if(pI.current)pI.current.destroy();
    const m={};expenses.forEach(e=>{const k=e.categories?.name||'Other';const c=e.categories?.color||'#6B7280';if(!m[k])m[k]={a:0,c};m[k].a+=parseFloat(e.amount);});
    const labs=Object.keys(m);
    pI.current=new Chart(pRef.current,{type:'doughnut',data:{labels:labs,datasets:[{data:labs.map(l=>m[l].a),backgroundColor:labs.map(l=>m[l].c),borderWidth:0,hoverOffset:7}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{position:'right',labels:{boxWidth:10,padding:14,font:{size:11},color:dark?'#9090a8':'#555568'}}}}});
    return()=>{if(pI.current)pI.current.destroy();};
  },[expenses,dark]);

  useEffect(()=>{
    if(!bRef.current)return;
    if(bI.current)bI.current.destroy();
    const ms=makeMonths(6);
    const labels=ms.map(d=>d.toLocaleString('default',{month:'short'}));
    const eD=ms.map(d=>expenses.filter(e=>{const ed=new Date(e.date);return ed.getMonth()===d.getMonth()&&ed.getFullYear()===d.getFullYear();}).reduce((s,e)=>s+parseFloat(e.amount),0));
    bI.current=new Chart(bRef.current,{type:'bar',data:{labels,datasets:[{data:eD,backgroundColor:'rgba(108,99,255,.65)',borderRadius:7,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{display:false},ticks:{font:{size:10},color:dark?'#9090a8':'#555568'}},y:{grid:{color:gc},beginAtZero:true,ticks:{font:{size:10},color:dark?'#9090a8':'#555568'}}}}});
    return()=>{if(bI.current)bI.current.destroy();};
  },[expenses,dark]);

  return(
    <div className="page">
      <div className="page-head" style={{marginBottom:28}}>
        <div><div className="page-title">Overview</div><div className="page-sub">{now.toLocaleString('default',{month:'long',year:'numeric'})} summary</div></div>
      </div>

      <div className="stats-row">
        {[
          {cls:'sc-income',ico:'üíµ',label:'Total Income',val:`‚Çπ${totalInc.toFixed(0)}`,badge:`This month ‚Çπ${mIT.toFixed(0)}`,bc:'rgba(56,189,248,.12)',btc:'var(--blue)',delay:0},
          {cls:'sc-expense',ico:'üí∏',label:'Total Expenses',val:`‚Çπ${totalExp.toFixed(0)}`,badge:`This month ‚Çπ${mET.toFixed(0)}`,bc:'rgba(255,92,124,.12)',btc:'var(--red)',delay:80},
          {cls:'sc-balance',ico:'üè¶',label:'Net Balance',val:`‚Çπ${Math.abs(bal).toFixed(0)}`,badge:`${totalInc>0?(((totalInc-totalExp)/totalInc)*100).toFixed(1):0}% saved`,bc:'rgba(16,217,140,.12)',btc:'var(--green)',delay:160},
        ].map(s=>(
          <div key={s.label} className={`stat-card ${s.cls}`} style={{animationDelay:`${s.delay}ms`}}>
            <div className="sc-glow"></div>
            <div className="sc-icon">{s.ico}</div>
            <div className="sc-label">{s.label}</div>
            <div className="sc-value">{s.val}</div>
            <div className="sc-badge" style={{background:s.bc,color:s.btc}}>{s.badge}</div>
          </div>
        ))}
      </div>

      <div className="charts-row">
        <div className="chart-card">
          <div className="chart-card-title">Income vs Expenses</div>
          <div className="chart-card-sub">7-month trend</div>
          <div className="chart-divider"></div>
          <div className="chart-area"><canvas ref={lRef}></canvas></div>
        </div>
        <div className="chart-card">
          <div className="chart-card-title">Spending by Category</div>
          <div className="chart-card-sub">All-time breakdown</div>
          <div className="chart-divider"></div>
          <div className="chart-area">
            {expenses.length>0?<canvas ref={pRef}></canvas>:<div className="empty"><div className="empty-ico">üìä</div><div className="empty-txt">No data yet</div><div className="empty-sub">Add expenses to see your chart</div></div>}
          </div>
        </div>
      </div>

      <div className="bottom-row">
        <div className="panel">
          <div className="panel-head"><div className="panel-title">Recent Expenses</div><div className="panel-action" onClick={()=>goTab('expenses')}>View all ‚Üí</div></div>
          {expenses.length===0
            ?<div className="empty"><div className="empty-ico">üí∏</div><div className="empty-txt">No expenses yet</div><div className="empty-sub">Start tracking your spending</div></div>
            :expenses.slice(0,5).map(e=>(
              <div key={e.id} className="txn">
                <div className="txn-ico" style={{background:`${e.categories?.color||'#6B7280'}20`}}>{e.categories?.icon||'üí∞'}</div>
                <div className="txn-info"><div className="txn-name">{e.description}</div><div className="txn-meta">{new Date(e.date).toLocaleDateString('en-IN',{day:'numeric',month:'short'})}</div></div>
                <div className="txn-right">
                  <div className="txn-amt" style={{color:'var(--red)'}}>-‚Çπ{parseFloat(e.amount).toFixed(0)}</div>
                  <div className="txn-tag" style={{background:`${e.categories?.color||'#6B7280'}18`,color:e.categories?.color||'#6B7280'}}>{e.categories?.name||'Other'}</div>
                </div>
              </div>
            ))
          }
        </div>
        <div style={{display:'flex',flexDirection:'column',gap:22}}>
          <div className="panel">
            <div className="panel-head"><div className="panel-title">üìÖ Monthly Budget</div></div>
            <div className="budget-row"><div className="budget-label">üíö Income</div><div className="budget-val" style={{color:'var(--green)'}}>‚Çπ{mIT.toFixed(0)}</div></div>
            <div className="budget-row"><div className="budget-label">üî¥ Expenses</div><div className="budget-val" style={{color:'var(--red)'}}>‚Çπ{mET.toFixed(0)}</div></div>
            <div className="prog-bg"><div className="prog-fill" style={{width:mIT>0?`${Math.min((mET/mIT)*100,100)}%`:'0%',background:mET/mIT>0.8?'var(--red)':'var(--green)'}}></div></div>
            <div className="budget-row" style={{marginBottom:0}}><div className="budget-label">üí∞ Remaining</div><div className="budget-val" style={{color:(mIT-mET)>=0?'var(--green)':'var(--red)'}}>‚Çπ{(mIT-mET).toFixed(0)}</div></div>
          </div>
          <div className="panel">
            <div className="panel-head"><div className="panel-title">Monthly Spend</div><div style={{fontSize:11,color:'var(--text3)'}}>Last 6 months</div></div>
            <div style={{height:170}}><canvas ref={bRef}></canvas></div>
          </div>
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ EXPENSES ‚îÄ‚îÄ */
function ExpensesTab({expenses,categories,onUpdate,user}){
  const[show,setShow]=useState(false);
  const[form,setForm]=useState({amount:'',description:'',category_id:'',date:new Date().toISOString().split('T')[0]});
  const[editId,setEid]=useState(null);
  const[fMonth,setFM]=useState('all');const[fYear,setFY]=useState(new Date().getFullYear().toString());
  const reset=()=>{setForm({amount:'',description:'',category_id:'',date:new Date().toISOString().split('T')[0]});setEid(null);};
  const submit=async(e)=>{e.preventDefault();if(editId)await sb.from('expenses').update(form).eq('id',editId);else await sb.from('expenses').insert({...form,user_id:user.id});reset();setShow(false);onUpdate();};
  const edit=(ex)=>{setForm({amount:ex.amount,description:ex.description,category_id:ex.category_id,date:ex.date});setEid(ex.id);setShow(true);};
  const del=async(id)=>{if(confirm('Delete this expense?')){await sb.from('expenses').delete().eq('id',id);onUpdate();}};
  const filtered=expenses.filter(e=>{const d=new Date(e.date);return(fYear==='all'||d.getFullYear().toString()===fYear)&&(fMonth==='all'||d.getMonth().toString()===fMonth);});
  const total=filtered.reduce((s,e)=>s+parseFloat(e.amount),0);
  return(
    <div className="page">
      <div className="page-head"><div><div className="page-title">üí∏ Expenses</div><div className="page-sub">{filtered.length} records ¬∑ ‚Çπ{total.toFixed(2)}</div></div>
        <button className="add-btn add-blue" onClick={()=>{setShow(!show);reset();}}>{show?'‚úï Cancel':'+ Add Expense'}</button>
      </div>
      {show&&(
        <div className="form-panel">
          <div className="form-panel-title">üí∏ {editId?'Edit':'New'} Expense</div>
          <form onSubmit={submit}>
            <div className="form-grid">
              <div className="fg"><label className="flabel">Amount (‚Çπ) *</label><input className="finput" type="number" step="0.01" placeholder="0.00" value={form.amount} onChange={e=>setForm({...form,amount:e.target.value})} required/></div>
              <div className="fg"><label className="flabel">Category *</label><select className="finput" value={form.category_id} onChange={e=>setForm({...form,category_id:e.target.value})} required><option value="">Select‚Ä¶</option>{categories.map(c=><option key={c.id} value={c.id}>{c.icon} {c.name}</option>)}</select></div>
              <div className="fg"><label className="flabel">Description *</label><input className="finput" type="text" placeholder="What did you spend on?" value={form.description} onChange={e=>setForm({...form,description:e.target.value})} required/></div>
              <div className="fg"><label className="flabel">Date *</label><input className="finput" type="date" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} required/></div>
            </div>
            <div className="form-btns"><button className="sbtn sbtn-blue" type="submit">{editId?'Update':'Add Expense'}</button><button className="sbtn sbtn-cancel" type="button" onClick={()=>setShow(false)}>Cancel</button></div>
          </form>
        </div>
      )}
      <div className="tbl-card">
        <div className="tbl-filters">
          <select className="fsel" value={fYear} onChange={e=>setFY(e.target.value)}><option value="all">All Years</option>{[2024,2025,2026].map(y=><option key={y} value={y}>{y}</option>)}</select>
          <select className="fsel" value={fMonth} onChange={e=>setFM(e.target.value)}><option value="all">All Months</option>{['January','February','March','April','May','June','July','August','September','October','November','December'].map((m,i)=><option key={i} value={i}>{m}</option>)}</select>
        </div>
        {filtered.length===0?<div className="empty"><div className="empty-ico">üí∏</div><div className="empty-txt">No expenses found</div><div className="empty-sub">Try changing filters</div></div>:(
          <div style={{overflowX:'auto'}}><table><thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead>
            <tbody>{filtered.map(e=>(
              <tr key={e.id}>
                <td style={{color:'var(--text2)'}}>{new Date(e.date).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})}</td>
                <td><span className="pill" style={{background:`${e.categories?.color||'#6B7280'}18`,color:e.categories?.color||'#6B7280'}}>{e.categories?.icon} {e.categories?.name||'‚Äî'}</span></td>
                <td style={{fontWeight:500}}>{e.description}</td>
                <td style={{color:'var(--red)',fontWeight:700}}>‚Çπ{parseFloat(e.amount).toFixed(2)}</td>
                <td><button className="act-btn act-edit" onClick={()=>edit(e)}>‚úèÔ∏è Edit</button><button className="act-btn act-del" onClick={()=>del(e.id)}>üóëÔ∏è</button></td>
              </tr>
            ))}</tbody>
          </table></div>
        )}
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ INCOME ‚îÄ‚îÄ */
function IncomeTab({income,onUpdate,user}){
  const[show,setShow]=useState(false);
  const[form,setForm]=useState({amount:'',source:'',description:'',date:new Date().toISOString().split('T')[0]});
  const[editId,setEid]=useState(null);
  const reset=()=>{setForm({amount:'',source:'',description:'',date:new Date().toISOString().split('T')[0]});setEid(null);};
  const submit=async(e)=>{e.preventDefault();if(editId)await sb.from('income').update(form).eq('id',editId);else await sb.from('income').insert({...form,user_id:user.id});reset();setShow(false);onUpdate();};
  const edit=(i)=>{setForm({amount:i.amount,source:i.source,description:i.description||'',date:i.date});setEid(i.id);setShow(true);};
  const del=async(id)=>{if(confirm('Delete this income?')){await sb.from('income').delete().eq('id',id);onUpdate();}};
  const total=income.reduce((s,i)=>s+parseFloat(i.amount),0);
  return(
    <div className="page">
      <div className="page-head"><div><div className="page-title">üíµ Income</div><div className="page-sub">{income.length} records ¬∑ ‚Çπ{total.toFixed(2)}</div></div>
        <button className="add-btn add-green" onClick={()=>{setShow(!show);reset();}}>{show?'‚úï Cancel':'+ Add Income'}</button>
      </div>
      {show&&(
        <div className="form-panel">
          <div className="form-panel-title">üíµ {editId?'Edit':'New'} Income</div>
          <form onSubmit={submit}>
            <div className="form-grid">
              <div className="fg"><label className="flabel">Amount (‚Çπ) *</label><input className="finput" type="number" step="0.01" placeholder="0.00" value={form.amount} onChange={e=>setForm({...form,amount:e.target.value})} required/></div>
              <div className="fg"><label className="flabel">Source *</label><input className="finput" type="text" placeholder="Salary, Pocket Money, Gift‚Ä¶" value={form.source} onChange={e=>setForm({...form,source:e.target.value})} required/></div>
              <div className="fg"><label className="flabel">Description (optional)</label><input className="finput" type="text" placeholder="Additional notes‚Ä¶" value={form.description} onChange={e=>setForm({...form,description:e.target.value})}/></div>
              <div className="fg"><label className="flabel">Date *</label><input className="finput" type="date" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} required/></div>
            </div>
            <div className="form-btns"><button className="sbtn sbtn-green" type="submit">{editId?'Update':'Add Income'}</button><button className="sbtn sbtn-cancel" type="button" onClick={()=>setShow(false)}>Cancel</button></div>
          </form>
        </div>
      )}
      <div className="tbl-card">
        {income.length===0?<div className="empty"><div className="empty-ico">üíµ</div><div className="empty-txt">No income yet</div><div className="empty-sub">Add your first income or pocket money</div></div>:(
          <div style={{overflowX:'auto'}}><table><thead><tr><th>Date</th><th>Source</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead>
            <tbody>{income.map(i=>(
              <tr key={i.id}>
                <td style={{color:'var(--text2)'}}>{new Date(i.date).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})}</td>
                <td><span className="pill" style={{background:'rgba(16,217,140,.12)',color:'var(--green)'}}>{i.source}</span></td>
                <td style={{color:'var(--text2)'}}>{i.description||'‚Äî'}</td>
                <td style={{color:'var(--green)',fontWeight:700}}>+‚Çπ{parseFloat(i.amount).toFixed(2)}</td>
                <td><button className="act-btn act-edit" onClick={()=>edit(i)}>‚úèÔ∏è Edit</button><button className="act-btn act-del" onClick={()=>del(i.id)}>üóëÔ∏è</button></td>
              </tr>
            ))}</tbody>
          </table></div>
        )}
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ CATEGORIES ‚îÄ‚îÄ */
function CategoriesTab({categories,onUpdate,user}){
  const[show,setShow]=useState(false);
  const[form,setForm]=useState({name:'',icon:'üí∞',color:'#6c63ff'});
  const[editId,setEid]=useState(null);
  const icons=['üçî','üöó','üéÆ','üõçÔ∏è','üìÑ','üíä','üìö','üè†','‚úàÔ∏è','üé¨','üí∞','üé®','‚öΩ','üì±','‚òï','üçï','üèãÔ∏è','üéµ','üêï','üíÑ'];
  const reset=()=>{setForm({name:'',icon:'üí∞',color:'#6c63ff'});setEid(null);};
  const submit=async(e)=>{e.preventDefault();if(editId)await sb.from('categories').update(form).eq('id',editId);else await sb.from('categories').insert({...form,user_id:user.id});reset();setShow(false);onUpdate();};
  const edit=(c)=>{setForm({name:c.name,icon:c.icon,color:c.color});setEid(c.id);setShow(true);};
  const del=async(id)=>{if(confirm('Delete category?')){await sb.from('categories').delete().eq('id',id);onUpdate();}};
  return(
    <div className="page">
      <div className="page-head"><div><div className="page-title">üè∑Ô∏è Categories</div><div className="page-sub">{categories.length} categories</div></div>
        <button className="add-btn add-purple" onClick={()=>{setShow(!show);reset();}}>{show?'‚úï Cancel':'+ Add Category'}</button>
      </div>
      {show&&(
        <div className="form-panel">
          <div className="form-panel-title">üè∑Ô∏è {editId?'Edit':'New'} Category</div>
          <form onSubmit={submit}>
            <div className="form-grid">
              <div className="fg"><label className="flabel">Name *</label><input className="finput" type="text" placeholder="e.g., Groceries" value={form.name} onChange={e=>setForm({...form,name:e.target.value})} required/></div>
              <div className="fg"><label className="flabel">Color *</label><input className="finput" type="color" value={form.color} onChange={e=>setForm({...form,color:e.target.value})} style={{height:46,padding:'4px 8px',cursor:'pointer'}}/></div>
              <div className="fg" style={{gridColumn:'span 2'}}>
                <label className="flabel">Icon ‚Äî selected: {form.icon}</label>
                <div style={{display:'flex',flexWrap:'wrap',gap:8,marginTop:4}}>
                  {icons.map(ic=><button key={ic} type="button" onClick={()=>setForm({...form,icon:ic})} style={{width:42,height:42,borderRadius:11,fontSize:20,border:form.icon===ic?'2px solid var(--accent)':'1.5px solid var(--border)',background:form.icon===ic?'rgba(108,99,255,.18)':'var(--bg2)',cursor:'pointer',transition:'all .15s'}}>{ic}</button>)}
                </div>
              </div>
            </div>
            <div className="form-btns"><button className="sbtn sbtn-blue" type="submit">{editId?'Update':'Add Category'}</button><button className="sbtn sbtn-cancel" type="button" onClick={()=>setShow(false)}>Cancel</button></div>
          </form>
        </div>
      )}
      <div className="cat-grid">
        {categories.map(c=>(
          <div key={c.id} className="cat-card">
            <div className="cat-ico-big" style={{background:`${c.color}20`}}>{c.icon}</div>
            <div style={{flex:1}}><div className="cat-name" style={{color:c.color}}>{c.name}</div><div className="cat-hex">{c.color}</div></div>
            <div style={{display:'flex',flexDirection:'column',gap:6}}><button className="act-btn act-edit" onClick={()=>edit(c)}>‚úèÔ∏è</button><button className="act-btn act-del" onClick={()=>del(c.id)}>üóëÔ∏è</button></div>
          </div>
        ))}
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ STATISTICS ‚îÄ‚îÄ */
function Statistics({expenses,income}){
  const bRef=useRef(),pRef=useRef();
  const bI=useRef(),pI=useRef();
  const totalInc=income.reduce((s,i)=>s+parseFloat(i.amount),0);
  const totalExp=expenses.reduce((s,e)=>s+parseFloat(e.amount),0);
  const avg=expenses.length>0?totalExp/expenses.length:0;
  const maxE=expenses.length>0?Math.max(...expenses.map(e=>parseFloat(e.amount))):0;
  const savings=totalInc>0?((totalInc-totalExp)/totalInc)*100:0;
  const catMap={};expenses.forEach(e=>{const k=e.categories?.name||'Other';const c=e.categories?.color||'#6B7280';const ic=e.categories?.icon||'üí∞';if(!catMap[k])catMap[k]={a:0,n:0,c,ic};catMap[k].a+=parseFloat(e.amount);catMap[k].n++;});
  const sorted=Object.entries(catMap).sort((a,b)=>b[1].a-a[1].a);
  useEffect(()=>{
    if(!bRef.current)return;if(bI.current)bI.current.destroy();
    const ms=[];for(let i=11;i>=0;i--){const d=new Date();d.setMonth(d.getMonth()-i);ms.push(d);}
    const labs=ms.map(d=>d.toLocaleString('default',{month:'short'}));
    const eD=ms.map(d=>expenses.filter(e=>{const ed=new Date(e.date);return ed.getMonth()===d.getMonth()&&ed.getFullYear()===d.getFullYear();}).reduce((s,e)=>s+parseFloat(e.amount),0));
    const iD=ms.map(d=>income.filter(i=>{const id=new Date(i.date);return id.getMonth()===d.getMonth()&&id.getFullYear()===d.getFullYear();}).reduce((s,i)=>s+parseFloat(i.amount),0));
    bI.current=new Chart(bRef.current,{type:'bar',data:{labels:labs,datasets:[{label:'Income',data:iD,backgroundColor:'rgba(16,217,140,.65)',borderRadius:7,borderSkipped:false},{label:'Expenses',data:eD,backgroundColor:'rgba(255,92,124,.65)',borderRadius:7,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:true,position:'top'}},scales:{x:{grid:{display:false}},y:{beginAtZero:true,grid:{color:'rgba(255,255,255,.05)'}}}}});
    return()=>{if(bI.current)bI.current.destroy();};
  },[expenses,income]);
  useEffect(()=>{
    if(!pRef.current||expenses.length===0)return;if(pI.current)pI.current.destroy();
    const labs=sorted.map(([k])=>k);const vals=sorted.map(([,v])=>v.a);const cols=sorted.map(([,v])=>v.c);
    pI.current=new Chart(pRef.current,{type:'doughnut',data:{labels:labs,datasets:[{data:vals,backgroundColor:cols,borderWidth:0,hoverOffset:8}]},options:{responsive:true,maintainAspectRatio:false,cutout:'65%',plugins:{legend:{position:'bottom',labels:{boxWidth:12,padding:16}}}}});
    return()=>{if(pI.current)pI.current.destroy();};
  },[expenses]);
  return(
    <div className="page">
      <div className="page-head"><div><div className="page-title">üìä Statistics</div><div className="page-sub">Detailed financial analytics</div></div></div>
      <div className="stats-mini-row">
        {[{l:'Transactions',v:expenses.length+income.length,c:'var(--accent2)'},{l:'Avg Expense',v:`‚Çπ${avg.toFixed(0)}`,c:'var(--red)'},{l:'Highest Expense',v:`‚Çπ${maxE.toFixed(0)}`,c:'var(--orange)'},{l:'Savings Rate',v:`${savings.toFixed(1)}%`,c:'var(--green)'}].map((s,i)=>(
          <div key={i} className="stat-mini" style={{animationDelay:`${i*70}ms`}}><div className="stat-mini-label">{s.l}</div><div className="stat-mini-val" style={{color:s.c}}>{s.v}</div></div>
        ))}
      </div>
      <div className="charts-row" style={{marginBottom:26}}>
        <div className="chart-card"><div className="chart-card-title">12-Month Overview</div><div className="chart-card-sub">Income vs Expenses comparison</div><div className="chart-divider"></div><div className="chart-area"><canvas ref={bRef}></canvas></div></div>
        <div className="chart-card"><div className="chart-card-title">Category Distribution</div><div className="chart-card-sub">All-time breakdown</div><div className="chart-divider"></div><div className="chart-area">{expenses.length>0?<canvas ref={pRef}></canvas>:<div className="empty"><div className="empty-ico">üìä</div><div className="empty-txt">No data yet</div></div>}</div></div>
      </div>
      <div className="tbl-card" style={{borderRadius:'var(--radius)'}}>
        <div style={{padding:'20px 24px',borderBottom:'1px solid var(--border)',fontSize:15,fontWeight:700}}>Category Breakdown</div>
        <div style={{padding:'8px 24px 16px'}}>
          {sorted.length===0?<div className="empty"><div className="empty-ico">üè∑Ô∏è</div><div className="empty-txt">No data yet</div></div>:sorted.map(([name,s])=>(
            <div key={name} className="breakdown-item">
              <div className="bk-ico" style={{background:`${s.c}18`}}>{s.ic}</div>
              <div style={{flex:1}}><div className="bk-name" style={{color:s.c}}>{name} <span style={{color:'var(--text3)',fontWeight:400,fontSize:11}}>({s.n})</span></div><div className="bk-bar-bg"><div className="bk-bar" style={{width:`${(s.a/totalExp)*100}%`,background:s.c}}></div></div></div>
              <div className="bk-right"><div className="bk-amt" style={{color:'var(--red)'}}>‚Çπ{s.a.toFixed(0)}</div><div className="bk-pct">{((s.a/totalExp)*100).toFixed(1)}%</div></div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
function App(){
  const[user,setUser]=useState(null);
  const[loading,setLoading]=useState(true);
  const[tab,setTab]=useState('dashboard');
  const[expenses,setExpenses]=useState([]);
  const[income,setIncome]=useState([]);
  const[categories,setCats]=useState([]);
  const[dark,setDark]=useState(true);

  useEffect(()=>checkUser(),[]);
  useEffect(()=>{if(user)loadAll();},[user]);
  useEffect(()=>{document.body.className=dark?'':'light';},[dark]);

  const checkUser=async()=>{const{data:{session}}=await sb.auth.getSession();setUser(session?.user??null);setLoading(false);};
  const loadAll=()=>Promise.all([loadExp(),loadInc(),loadCats()]);
  const loadExp=async()=>{const{data}=await sb.from('expenses').select('*,categories(name,color,icon)').order('date',{ascending:false});setExpenses(data||[]);};
  const loadInc=async()=>{const{data}=await sb.from('income').select('*').order('date',{ascending:false});setIncome(data||[]);};
  const loadCats=async()=>{
    const{data}=await sb.from('categories').select('*').order('name');
    if(data&&data.length>0){setCats(data);}
    else{const defaults=[{name:'Food',icon:'üçî',color:'#EF4444'},{name:'Transport',icon:'üöó',color:'#3B82F6'},{name:'Entertainment',icon:'üéÆ',color:'#8B5CF6'},{name:'Shopping',icon:'üõçÔ∏è',color:'#EC4899'},{name:'Bills',icon:'üìÑ',color:'#F59E0B'},{name:'Health',icon:'üíä',color:'#10B981'},{name:'Education',icon:'üìö',color:'#6366F1'},{name:'Others',icon:'üí∞',color:'#6B7280'}];for(const c of defaults)await sb.from('categories').insert({user_id:user.id,...c});loadCats();}
  };
  const logout=async()=>{await sb.auth.signOut();setUser(null);};

  if(loading)return<div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh',fontSize:18,color:'var(--text3)'}}>‚è≥ Loading‚Ä¶</div>;
  if(!user)return<Auth onOK={setUser}/>;

  const email=user.email||'';
  const initials=email.substring(0,2).toUpperCase();
  const today=new Date().toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'long'});

  const navItems=[
    {id:'dashboard',ico:'‚ö°',label:'Dashboard'},
    {id:'income',   ico:'üíµ',label:'Income'},
    {id:'expenses', ico:'üí∏',label:'Expenses'},
    {id:'categories',ico:'üè∑Ô∏è',label:'Categories'},
    {id:'statistics',ico:'üìä',label:'Stats'},
  ];

  return(
    <div className="app-wrap">
      {/* SIDEBAR */}
      <aside className="sidebar">
        <div className="sidebar-logo">
          <div className="sidebar-logo-icon">üí∞</div>
          <div><div className="sidebar-logo-name">Expense</div><div className="sidebar-logo-sub">MANAGER PRO</div></div>
        </div>
        <div className="nav-section-label">Main</div>
        {navItems.map(n=>(
          <button key={n.id} className={`nav-item${tab===n.id?' active':''}`} onClick={()=>setTab(n.id)}>
            <span className="nav-icon">{n.ico}</span>{n.label}
          </button>
        ))}
        <div className="sidebar-spacer"></div>
        <div className="sidebar-user">
          <div className="user-avatar">{initials}</div>
          <div><div className="user-name">{initials}</div><div className="user-email">{email}</div></div>
        </div>
        <button className="btn-logout" onClick={logout}>üö™ Sign Out</button>
      </aside>

      {/* MAIN */}
      <div className="main">
        {/* Desktop topbar */}
        <div className="topbar">
          <div><div className="topbar-greet">Hi {initials} üëã</div><div className="topbar-date">{today}</div></div>
          <div className="topbar-right">
            <div className="icon-btn"><span>üîî</span><div className="notif-dot"></div></div>
            <div className="icon-btn" onClick={()=>setDark(!dark)}>{dark?'‚òÄÔ∏è':'üåô'}</div>
          </div>
        </div>

        {/* Mobile topbar */}
        <div className="mobile-topbar">
          <div className="mobile-logo">
            <div className="mobile-logo-ico">üí∞</div>
            <div className="mobile-logo-name">Expense Manager</div>
          </div>
          <div style={{display:'flex',gap:8}}>
            <div className="icon-btn" style={{width:38,height:38}} onClick={()=>setDark(!dark)}>{dark?'‚òÄÔ∏è':'üåô'}</div>
          </div>
        </div>

        {tab==='dashboard'  &&<Dashboard   expenses={expenses} income={income} dark={dark} goTab={setTab}/>}
        {tab==='expenses'   &&<ExpensesTab expenses={expenses} categories={categories} onUpdate={loadExp} user={user}/>}
        {tab==='income'     &&<IncomeTab   income={income} onUpdate={loadInc} user={user}/>}
        {tab==='categories' &&<CategoriesTab categories={categories} onUpdate={loadCats} user={user}/>}
        {tab==='statistics' &&<Statistics  expenses={expenses} income={income}/>}
      </div>

      {/* MOBILE BOTTOM NAV */}
      <nav className="bottom-nav">
        <div className="bottom-nav-inner">
          {navItems.map(n=>(
            <button key={n.id} className={`bn-item${tab===n.id?' active':''}`} onClick={()=>setTab(n.id)}>
              <div className="bn-ico-wrap">{n.ico}</div>
              <span className="bn-label">{n.label}</span>
            </button>
          ))}
        </div>
      </nav>
    </div>
  );
}

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
