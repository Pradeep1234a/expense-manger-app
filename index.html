<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0f13;
      --bg2: #16161d;
      --bg3: #1e1e28;
      --card: #1a1a24;
      --card2: #22222f;
      --border: #2a2a3a;
      --text: #f0f0f8;
      --text2: #9090a8;
      --text3: #5a5a70;
      --accent: #6c63ff;
      --accent2: #a78bfa;
      --green: #10d98c;
      --green2: #059669;
      --red: #ff5c7c;
      --red2: #dc2626;
      --yellow: #fbbf24;
      --blue: #38bdf8;
      --pink: #f472b6;
      --orange: #fb923c;
    }
    .light {
      --bg: #f4f4f8;
      --bg2: #ebebf2;
      --bg3: #e2e2ec;
      --card: #ffffff;
      --card2: #f8f8fc;
      --border: #dcdce8;
      --text: #111118;
      --text2: #555568;
      --text3: #9090a8;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg2); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    /* AUTH */
    .auth-wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      position: relative;
      overflow: hidden;
    }
    .auth-glow {
      position: absolute;
      width: 500px; height: 500px;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.15;
      pointer-events: none;
    }
    .auth-glow-1 { background: var(--accent); top: -100px; left: -100px; }
    .auth-glow-2 { background: var(--green); bottom: -100px; right: -100px; }
    .auth-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 48px;
      width: 100%;
      max-width: 420px;
      position: relative;
      z-index: 1;
      box-shadow: 0 24px 60px rgba(0,0,0,0.4);
      animation: slideUp 0.5s ease;
    }
    @keyframes slideUp {
      from { opacity:0; transform:translateY(30px); }
      to { opacity:1; transform:translateY(0); }
    }
    .auth-logo {
      width: 64px; height: 64px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 20px;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; margin: 0 auto 20px;
      box-shadow: 0 8px 24px rgba(108,99,255,0.4);
    }
    .auth-title { font-size: 26px; font-weight: 800; text-align:center; margin-bottom:4px; }
    .auth-sub { color: var(--text2); text-align:center; font-size:14px; margin-bottom:32px; }
    .form-group { margin-bottom: 16px; }
    .form-label { display:block; font-size:13px; font-weight:600; color:var(--text2); margin-bottom:8px; letter-spacing:0.5px; text-transform:uppercase; }
    .form-input {
      width: 100%;
      background: var(--bg2);
      border: 1.5px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--text);
      font-family: inherit;
      font-size: 15px;
      transition: all 0.2s;
      outline: none;
    }
    .form-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.15); }
    .form-input::placeholder { color: var(--text3); }
    .btn {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: white;
      box-shadow: 0 8px 20px rgba(108,99,255,0.35);
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 12px 28px rgba(108,99,255,0.45); }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
    .auth-switch { text-align:center; margin-top:20px; color:var(--text2); font-size:14px; }
    .auth-switch a { color:var(--accent2); cursor:pointer; font-weight:600; }
    .error-box {
      background: rgba(255,92,124,0.1);
      border: 1px solid rgba(255,92,124,0.3);
      color: var(--red);
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 14px;
      margin-bottom: 16px;
    }

    /* LAYOUT */
    .app-layout { display: flex; min-height: 100vh; }

    /* SIDEBAR */
    .sidebar {
      width: 240px;
      background: var(--card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 24px 16px;
      position: fixed;
      height: 100vh;
      z-index: 100;
      transition: all 0.3s;
    }
    .sidebar-logo {
      display: flex; align-items: center; gap: 12px;
      padding: 8px 12px;
      margin-bottom: 32px;
    }
    .sidebar-logo-icon {
      width: 42px; height: 42px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(108,99,255,0.3);
    }
    .sidebar-logo-text { font-size: 16px; font-weight: 800; }
    .sidebar-logo-sub { font-size: 11px; color: var(--text3); }
    .nav-label {
      font-size: 10px;
      font-weight: 700;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 12px;
      margin-bottom: 8px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 12px;
      padding: 11px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      font-weight: 500;
      color: var(--text2);
      margin-bottom: 4px;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-family: inherit;
    }
    .nav-item:hover { background: var(--bg2); color: var(--text); }
    .nav-item.active {
      background: linear-gradient(135deg, rgba(108,99,255,0.15), rgba(167,139,250,0.1));
      color: var(--accent2);
      font-weight: 600;
      border: 1px solid rgba(108,99,255,0.2);
    }
    .nav-icon { width: 22px; text-align: center; font-size: 16px; }
    .sidebar-bottom { margin-top: auto; }
    .user-card {
      display: flex; align-items: center; gap: 12px;
      background: var(--bg2);
      border-radius: 14px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .user-avatar {
      width: 38px; height: 38px;
      background: linear-gradient(135deg, var(--accent), var(--pink));
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      font-weight: 700;
      color: white;
      flex-shrink: 0;
    }
    .user-name { font-size: 13px; font-weight: 700; }
    .user-email { font-size: 11px; color: var(--text3); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 130px; }
    .btn-logout {
      width: 100%; padding: 10px;
      background: rgba(255,92,124,0.1);
      border: 1px solid rgba(255,92,124,0.2);
      color: var(--red);
      border-radius: 10px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-logout:hover { background: rgba(255,92,124,0.2); }

    /* MAIN */
    .main-content {
      flex: 1;
      margin-left: 240px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* TOP BAR */
    .topbar {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .topbar-greeting { font-size: 20px; font-weight: 800; }
    .topbar-date { font-size: 13px; color: var(--text3); margin-top: 2px; }
    .topbar-right { display: flex; align-items: center; gap: 12px; }
    .dark-toggle {
      width: 40px; height: 40px;
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.2s;
      border: none;
    }
    .dark-toggle:hover { background: var(--bg3); transform: scale(1.05); }
    .notif-btn {
      width: 40px; height: 40px;
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 18px;
      border: none;
      transition: all 0.2s;
      position: relative;
    }
    .notif-dot {
      width: 8px; height: 8px;
      background: var(--red);
      border-radius: 50%;
      position: absolute;
      top: 8px; right: 8px;
      border: 2px solid var(--card);
    }

    /* PAGE CONTENT */
    .page { padding: 32px; }
    .page-header { margin-bottom: 28px; }
    .page-title { font-size: 24px; font-weight: 800; }
    .page-sub { font-size: 14px; color: var(--text3); margin-top: 4px; }

    /* STAT CARDS */
    .stats-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 20px; margin-bottom: 28px; }
    .stat-card {
      border-radius: 20px;
      padding: 24px;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.4s ease both;
    }
    @keyframes fadeIn { from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)} }
    .stat-card-1 { background: linear-gradient(135deg, #1a2640, #0f1d35); border: 1px solid rgba(56,189,248,0.2); }
    .stat-card-2 { background: linear-gradient(135deg, #1a1228, #0f0a1e); border: 1px solid rgba(108,99,255,0.2); }
    .stat-card-3 { background: linear-gradient(135deg, #0f2318, #071a10); border: 1px solid rgba(16,217,140,0.2); }
    .light .stat-card-1 { background: linear-gradient(135deg, #dbeafe, #eff6ff); border-color: rgba(56,189,248,0.3); }
    .light .stat-card-2 { background: linear-gradient(135deg, #ede9fe, #f5f3ff); border-color: rgba(108,99,255,0.3); }
    .light .stat-card-3 { background: linear-gradient(135deg, #d1fae5, #ecfdf5); border-color: rgba(16,217,140,0.3); }
    .stat-card::before {
      content:'';
      position:absolute;
      width:120px; height:120px;
      border-radius:50%;
      top:-30px; right:-30px;
      opacity:0.08;
    }
    .stat-card-1::before { background: var(--blue); }
    .stat-card-2::before { background: var(--accent); }
    .stat-card-3::before { background: var(--green); }
    .stat-icon-wrap {
      width: 48px; height: 48px;
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
      margin-bottom: 16px;
    }
    .stat-icon-1 { background: rgba(56,189,248,0.15); }
    .stat-icon-2 { background: rgba(108,99,255,0.15); }
    .stat-icon-3 { background: rgba(16,217,140,0.15); }
    .stat-label { font-size: 12px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
    .stat-value { font-size: 28px; font-weight: 800; line-height: 1; margin-bottom: 8px; }
    .stat-value-1 { color: var(--blue); }
    .stat-value-2 { color: var(--accent2); }
    .stat-value-3 { color: var(--green); }
    .stat-change { font-size: 12px; color: var(--text3); }
    .stat-change span { color: var(--green); font-weight: 600; }

    /* CHARTS GRID */
    .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 28px; }
    .chart-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      animation: fadeIn 0.5s ease 0.1s both;
    }
    .chart-title { font-size: 15px; font-weight: 700; margin-bottom: 4px; }
    .chart-sub { font-size: 12px; color: var(--text3); margin-bottom: 20px; }
    .chart-wrap { position: relative; height: 220px; }

    /* TRANSACTIONS */
    .bottom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .transactions-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      animation: fadeIn 0.5s ease 0.2s both;
    }
    .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    .card-title { font-size: 15px; font-weight: 700; }
    .card-action { font-size: 12px; color: var(--accent2); cursor: pointer; font-weight: 600; }
    .txn-item {
      display: flex; align-items: center; gap: 14px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      transition: all 0.2s;
    }
    .txn-item:last-child { border-bottom: none; }
    .txn-item:hover { padding-left: 4px; }
    .txn-icon {
      width: 42px; height: 42px;
      border-radius: 13px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }
    .txn-info { flex: 1; min-width: 0; }
    .txn-name { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .txn-date { font-size: 12px; color: var(--text3); margin-top: 2px; }
    .txn-amount { font-size: 15px; font-weight: 700; white-space: nowrap; }
    .txn-tag {
      font-size: 10px;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* MONTH SUMMARY */
    .month-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      animation: fadeIn 0.5s ease 0.15s both;
    }
    .month-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
    .month-label { font-size: 13px; font-weight: 600; color: var(--text2); display: flex; align-items: center; gap: 8px; }
    .month-val { font-size: 15px; font-weight: 700; }
    .progress-bg { background: var(--bg2); border-radius: 6px; height: 6px; margin-bottom: 16px; overflow: hidden; }
    .progress-bar { height: 100%; border-radius: 6px; transition: width 1s ease; }

    /* FORMS PANEL */
    .form-panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 24px;
      animation: slideDown 0.3s ease;
    }
    @keyframes slideDown { from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)} }
    .form-panel-title { font-size: 17px; font-weight: 800; margin-bottom: 24px; display: flex; align-items: center; gap: 10px; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-group2 { display: flex; flex-direction: column; gap: 8px; }
    .form-label2 { font-size: 12px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; }
    .form-input2 {
      background: var(--bg2);
      border: 1.5px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
      width: 100%;
    }
    .form-input2:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.1); }
    .form-input2::placeholder { color: var(--text3); }
    .form-actions { display: flex; gap: 12px; margin-top: 20px; }
    .btn-submit {
      padding: 12px 28px;
      border-radius: 12px;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-green { background: linear-gradient(135deg, var(--green2), #10d98c); color: white; box-shadow: 0 6px 16px rgba(16,217,140,0.25); }
    .btn-green:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(16,217,140,0.35); }
    .btn-blue { background: linear-gradient(135deg, #1d4ed8, var(--accent)); color: white; box-shadow: 0 6px 16px rgba(108,99,255,0.25); }
    .btn-blue:hover { transform: translateY(-1px); }
    .btn-cancel { background: var(--bg2); border: 1px solid var(--border); color: var(--text2); padding: 12px 20px; border-radius: 12px; font-family: inherit; font-size: 14px; font-weight: 600; cursor: pointer; }
    .btn-cancel:hover { background: var(--bg3); }
    .btn-add {
      display: flex; align-items: center; gap: 8px;
      padding: 11px 20px;
      border-radius: 12px;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-add-green { background: linear-gradient(135deg, var(--green2), #10d98c); color: white; box-shadow: 0 6px 16px rgba(16,217,140,0.3); }
    .btn-add-blue { background: linear-gradient(135deg, #1d4ed8, var(--accent)); color: white; box-shadow: 0 6px 16px rgba(108,99,255,0.3); }
    .btn-add-purple { background: linear-gradient(135deg, #7c3aed, var(--accent2)); color: white; box-shadow: 0 6px 16px rgba(124,58,237,0.3); }
    .btn-add:hover { transform: translateY(-1px); }

    /* TABLE */
    .table-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; animation: fadeIn 0.4s ease; }
    .table-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    thead tr { background: var(--bg2); }
    th { padding: 12px 20px; text-align: left; font-size: 11px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap; }
    td { padding: 14px 20px; font-size: 14px; color: var(--text); border-bottom: 1px solid var(--border); }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover { background: var(--bg2); }
    .pill {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
    }
    .action-btn {
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
    }
    .edit-btn { background: rgba(108,99,255,0.1); color: var(--accent2); margin-right: 6px; }
    .edit-btn:hover { background: rgba(108,99,255,0.2); }
    .del-btn { background: rgba(255,92,124,0.1); color: var(--red); }
    .del-btn:hover { background: rgba(255,92,124,0.2); }
    .filter-bar { display: flex; gap: 12px; padding: 16px 24px; border-bottom: 1px solid var(--border); background: var(--bg2); }
    .filter-select {
      background: var(--card);
      border: 1.5px solid var(--border);
      border-radius: 10px;
      padding: 8px 14px;
      color: var(--text);
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      outline: none;
      cursor: pointer;
    }
    .empty-state { text-align: center; padding: 60px 20px; color: var(--text3); }
    .empty-icon { font-size: 48px; margin-bottom: 12px; }
    .empty-text { font-size: 15px; font-weight: 600; margin-bottom: 4px; color: var(--text2); }
    .empty-sub { font-size: 13px; }

    /* CATEGORIES GRID */
    .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .cat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      display: flex; align-items: center; gap: 14px;
      transition: all 0.2s;
      animation: fadeIn 0.4s ease;
    }
    .cat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
    .cat-icon-big { width: 52px; height: 52px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
    .cat-info { flex: 1; }
    .cat-name { font-size: 15px; font-weight: 700; margin-bottom: 4px; }
    .cat-hex { font-size: 11px; color: var(--text3); }
    .cat-actions { display: flex; flex-direction: column; gap: 6px; }

    /* STATS PAGE */
    .stats-page-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
    .stat-mini { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
    .stat-mini-label { font-size: 12px; color: var(--text3); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .stat-mini-val { font-size: 24px; font-weight: 800; }
    .breakdown-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
    .breakdown-item:last-child { border: none; }
    .breakdown-icon { width: 38px; height: 38px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 17px; flex-shrink: 0; }
    .breakdown-info { flex: 1; }
    .breakdown-name { font-size: 13px; font-weight: 600; }
    .breakdown-bar-wrap { height: 4px; background: var(--bg2); border-radius: 4px; margin-top: 6px; overflow: hidden; }
    .breakdown-bar { height: 100%; border-radius: 4px; }
    .breakdown-amount { font-size: 14px; font-weight: 700; text-align: right; }
    .breakdown-pct { font-size: 11px; color: var(--text3); text-align: right; }
    
    @media (max-width: 900px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; }
      .stats-grid { grid-template-columns: 1fr; }
      .charts-grid, .bottom-grid, .stats-page-grid { grid-template-columns: 1fr; }
      .cat-grid { grid-template-columns: 1fr 1fr; }
      .form-grid { grid-template-columns: 1fr; }
      .page { padding: 16px; }
      .topbar { padding: 14px 16px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const SUPABASE_URL = 'https://lspjxjmbzgxtthpahfro.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzcGp4am1iemd4dHRocGFoZnJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNDI4NDQsImV4cCI6MjA4NjgxODg0NH0.jF1tjzP0qtcCqlCTyUx1jCL7LTuNW_gKJ1oPJJsvixE';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ‚îÄ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function AuthForm({ onSuccess }) {
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const submit = async (e) => {
        e.preventDefault(); setError(''); setLoading(true);
        try {
          if (isLogin) {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            onSuccess(data.user);
          } else {
            const { data, error } = await supabase.auth.signUp({ email, password });
            if (error) throw error;
            if (data.user) {
              await supabase.from('profiles').insert({ id: data.user.id, email, full_name: name });
              onSuccess(data.user);
            }
          }
        } catch (e) { setError(e.message); } finally { setLoading(false); }
      };

      return (
        <div className="auth-wrap">
          <div className="auth-glow auth-glow-1"></div>
          <div className="auth-glow auth-glow-2"></div>
          <div className="auth-card">
            <div className="auth-logo">üí∞</div>
            <div className="auth-title">Expense Manager</div>
            <div className="auth-sub">{isLogin ? 'Welcome back! Sign in to continue' : 'Create your free account today'}</div>
            <form onSubmit={submit}>
              {!isLogin && (
                <div className="form-group">
                  <label className="form-label">Full Name</label>
                  <input className="form-input" type="text" placeholder="Your name" value={name} onChange={e=>setName(e.target.value)} required={!isLogin} />
                </div>
              )}
              <div className="form-group">
                <label className="form-label">Email Address</label>
                <input className="form-input" type="email" placeholder="you@example.com" value={email} onChange={e=>setEmail(e.target.value)} required />
              </div>
              <div className="form-group">
                <label className="form-label">Password</label>
                <input className="form-input" type="password" placeholder="Min 6 characters" value={password} onChange={e=>setPassword(e.target.value)} required minLength={6} />
              </div>
              {error && <div className="error-box">‚ö†Ô∏è {error}</div>}
              <button className="btn btn-primary" type="submit" disabled={loading}>
                {loading ? '‚è≥ Please wait...' : (isLogin ? '‚Üí Sign In' : '‚Üí Create Account')}
              </button>
            </form>
            <div className="auth-switch">
              {isLogin ? "Don't have an account? " : "Already have an account? "}
              <a onClick={()=>setIsLogin(!isLogin)}>{isLogin ? 'Sign Up' : 'Sign In'}</a>
            </div>
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function Dashboard({ expenses, income, dark, setTab }) {
      const lineRef = useRef(null);
      const barRef = useRef(null);
      const pieRef = useRef(null);
      const lineInstance = useRef(null);
      const barInstance = useRef(null);
      const pieInstance = useRef(null);

      const totalIncome = income.reduce((s,i)=>s+parseFloat(i.amount),0);
      const totalExp    = expenses.reduce((s,e)=>s+parseFloat(e.amount),0);
      const balance     = totalIncome - totalExp;
      const now = new Date();
      const mExp  = expenses.filter(e=>{ const d=new Date(e.date); return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear(); });
      const mInc  = income.filter(i=>{ const d=new Date(i.date); return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear(); });
      const mExpT = mExp.reduce((s,e)=>s+parseFloat(e.amount),0);
      const mIncT = mInc.reduce((s,i)=>s+parseFloat(i.amount),0);

      const gridColor = dark ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)';
      const labelColor = dark ? '#9090a8' : '#555568';
      Chart.defaults.color = labelColor;

      useEffect(()=>{
        if(lineRef.current){
          if(lineInstance.current) lineInstance.current.destroy();
          // last 7 months
          const months=[]; const expData=[]; const incData=[];
          for(let i=6;i>=0;i--){
            const d=new Date(); d.setMonth(d.getMonth()-i);
            const label=d.toLocaleString('default',{month:'short'});
            months.push(label);
            expData.push(expenses.filter(e=>{ const ed=new Date(e.date); return ed.getMonth()===d.getMonth()&&ed.getFullYear()===d.getFullYear(); }).reduce((s,e)=>s+parseFloat(e.amount),0));
            incData.push(income.filter(i2=>{ const id=new Date(i2.date); return id.getMonth()===d.getMonth()&&id.getFullYear()===d.getFullYear(); }).reduce((s,i2)=>s+parseFloat(i2.amount),0));
          }
          lineInstance.current = new Chart(lineRef.current,{
            type:'line',
            data:{labels:months,datasets:[
              {label:'Income',data:incData,borderColor:'#10d98c',backgroundColor:'rgba(16,217,140,0.08)',tension:0.4,borderWidth:2.5,pointRadius:4,pointBackgroundColor:'#10d98c'},
              {label:'Expenses',data:expData,borderColor:'#ff5c7c',backgroundColor:'rgba(255,92,124,0.08)',tension:0.4,borderWidth:2.5,pointRadius:4,pointBackgroundColor:'#ff5c7c'}
            ]},
            options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:true,position:'top',labels:{boxWidth:10,padding:16,font:{size:12}}}},scales:{x:{grid:{color:gridColor},ticks:{font:{size:11}}},y:{grid:{color:gridColor},beginAtZero:true,ticks:{font:{size:11}}}}}
          });
        }
        return ()=>{ if(lineInstance.current) lineInstance.current.destroy(); };
      },[expenses,income,dark]);

      useEffect(()=>{
        if(pieRef.current && expenses.length>0){
          if(pieInstance.current) pieInstance.current.destroy();
          const catMap={};
          expenses.forEach(e=>{
            const k=e.categories?.name||'Other';
            const c=e.categories?.color||'#6B7280';
            if(!catMap[k]) catMap[k]={amount:0,color:c};
            catMap[k].amount+=parseFloat(e.amount);
          });
          const labs=Object.keys(catMap);
          pieInstance.current = new Chart(pieRef.current,{
            type:'doughnut',
            data:{labels:labs,datasets:[{data:labs.map(l=>catMap[l].amount),backgroundColor:labs.map(l=>catMap[l].color),borderWidth:0,hoverOffset:6}]},
            options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{boxWidth:10,padding:14,font:{size:11}}}},cutout:'70%'}
          });
        }
        return ()=>{ if(pieInstance.current) pieInstance.current.destroy(); };
      },[expenses,dark]);

      useEffect(()=>{
        if(barRef.current){
          if(barInstance.current) barInstance.current.destroy();
          const months=[]; const expData=[];
          for(let i=5;i>=0;i--){
            const d=new Date(); d.setMonth(d.getMonth()-i);
            months.push(d.toLocaleString('default',{month:'short'}));
            expData.push(expenses.filter(e=>{ const ed=new Date(e.date); return ed.getMonth()===d.getMonth()&&ed.getFullYear()===d.getFullYear(); }).reduce((s,e)=>s+parseFloat(e.amount),0));
          }
          barInstance.current = new Chart(barRef.current,{
            type:'bar',
            data:{labels:months,datasets:[{label:'Expenses',data:expData,backgroundColor:'rgba(108,99,255,0.7)',borderRadius:8,borderSkipped:false}]},
            options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{display:false},ticks:{font:{size:11}}},y:{grid:{color:gridColor},beginAtZero:true,ticks:{font:{size:11}}}}}
          });
        }
        return ()=>{ if(barInstance.current) barInstance.current.destroy(); };
      },[expenses,dark]);

      const catMap={};
      expenses.forEach(e=>{
        const k=e.categories?.name||'Other';
        const c=e.categories?.color||'#6B7280';
        const ic=e.categories?.icon||'üí∞';
        if(!catMap[k]) catMap[k]={amount:0,color:c,icon:ic};
        catMap[k].amount+=parseFloat(e.amount);
      });

      return (
        <div className="page">
          <div className="page-header">
            <div className="page-title">Overview</div>
            <div className="page-sub">{now.toLocaleString('default',{month:'long',year:'numeric'})} financial summary</div>
          </div>

          {/* Stat Cards */}
          <div className="stats-grid">
            <div className="stat-card stat-card-1" style={{animationDelay:'0ms'}}>
              <div className="stat-icon-wrap stat-icon-1">üíµ</div>
              <div className="stat-label">Total Income</div>
              <div className="stat-value stat-value-1">‚Çπ{totalIncome.toFixed(0)}</div>
              <div className="stat-change">This month: <span>‚Çπ{mIncT.toFixed(0)}</span></div>
            </div>
            <div className="stat-card stat-card-2" style={{animationDelay:'80ms'}}>
              <div className="stat-icon-wrap stat-icon-2">üí∏</div>
              <div className="stat-label">Total Expenses</div>
              <div className="stat-value stat-value-2">‚Çπ{totalExp.toFixed(0)}</div>
              <div className="stat-change">This month: <span style={{color:'var(--red)'}}>‚Çπ{mExpT.toFixed(0)}</span></div>
            </div>
            <div className="stat-card stat-card-3" style={{animationDelay:'160ms'}}>
              <div className="stat-icon-wrap stat-icon-3">üè¶</div>
              <div className="stat-label">Net Balance</div>
              <div className="stat-value" style={{color:balance>=0?'var(--green)':'var(--red)'}}>‚Çπ{balance.toFixed(0)}</div>
              <div className="stat-change">Savings rate: <span>{totalIncome>0?(((totalIncome-totalExp)/totalIncome)*100).toFixed(1):0}%</span></div>
            </div>
          </div>

          {/* Charts */}
          <div className="charts-grid">
            <div className="chart-card">
              <div className="chart-title">Income vs Expenses</div>
              <div className="chart-sub">7-month trend overview</div>
              <div className="chart-wrap"><canvas ref={lineRef}></canvas></div>
            </div>
            <div className="chart-card">
              <div className="chart-title">Spending by Category</div>
              <div className="chart-sub">All time breakdown</div>
              <div className="chart-wrap">
                {expenses.length>0 ? <canvas ref={pieRef}></canvas> : <div className="empty-state"><div className="empty-icon">üìä</div><div className="empty-text">No data yet</div></div>}
              </div>
            </div>
          </div>

          {/* Bottom */}
          <div className="bottom-grid">
            {/* Recent Expenses */}
            <div className="transactions-card">
              <div className="card-header">
                <div className="card-title">Recent Expenses</div>
                <div className="card-action" onClick={()=>setTab('expenses')}>View all ‚Üí</div>
              </div>
              {expenses.length===0 ? (
                <div className="empty-state"><div className="empty-icon">üí∏</div><div className="empty-text">No expenses yet</div><div className="empty-sub">Start tracking your spending</div></div>
              ) : expenses.slice(0,5).map(e=>(
                <div key={e.id} className="txn-item">
                  <div className="txn-icon" style={{background:`${e.categories?.color||'#6B7280'}20`}}>{e.categories?.icon||'üí∞'}</div>
                  <div className="txn-info">
                    <div className="txn-name">{e.description}</div>
                    <div className="txn-date">{new Date(e.date).toLocaleDateString('en-IN',{day:'numeric',month:'short'})}</div>
                  </div>
                  <div>
                    <div className="txn-amount" style={{color:'var(--red)'}}>-‚Çπ{parseFloat(e.amount).toFixed(0)}</div>
                    <div className="txn-tag" style={{background:`${e.categories?.color||'#6B7280'}18`,color:e.categories?.color||'#6B7280',marginTop:4}}>{e.categories?.name||'Other'}</div>
                  </div>
                </div>
              ))}
            </div>

            {/* Month + Bar */}
            <div style={{display:'flex',flexDirection:'column',gap:'20px'}}>
              <div className="month-card">
                <div className="card-header"><div className="card-title">üìÖ Monthly Budget</div></div>
                <div className="month-row">
                  <div className="month-label">üíö Income</div>
                  <div className="month-val" style={{color:'var(--green)'}}>‚Çπ{mIncT.toFixed(0)}</div>
                </div>
                <div className="month-row">
                  <div className="month-label">üî¥ Expenses</div>
                  <div className="month-val" style={{color:'var(--red)'}}>‚Çπ{mExpT.toFixed(0)}</div>
                </div>
                <div className="progress-bg">
                  <div className="progress-bar" style={{width:mIncT>0?`${Math.min((mExpT/mIncT)*100,100)}%`:'0%',background:mExpT/mIncT>0.8?'var(--red)':'var(--green)'}}></div>
                </div>
                <div className="month-row" style={{marginBottom:0}}>
                  <div className="month-label">üí∞ Balance</div>
                  <div className="month-val" style={{color:(mIncT-mExpT)>=0?'var(--green)':'var(--red)'}}>‚Çπ{(mIncT-mExpT).toFixed(0)}</div>
                </div>
              </div>
              <div className="chart-card" style={{flex:1}}>
                <div className="chart-title">Monthly Spend</div>
                <div className="chart-sub">Last 6 months</div>
                <div className="chart-wrap" style={{height:'160px'}}><canvas ref={barRef}></canvas></div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ EXPENSES TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function ExpensesTab({ expenses, categories, onUpdate, user }) {
      const [show, setShow] = useState(false);
      const [form, setForm] = useState({ amount:'', description:'', category_id:'', date: new Date().toISOString().split('T')[0] });
      const [editId, setEditId] = useState(null);
      const [filterMonth, setFilterMonth] = useState('all');
      const [filterYear, setFilterYear] = useState(new Date().getFullYear().toString());

      const submit = async (e) => {
        e.preventDefault();
        if(editId) await supabase.from('expenses').update(form).eq('id',editId);
        else await supabase.from('expenses').insert({...form, user_id:user.id});
        setForm({ amount:'', description:'', category_id:'', date: new Date().toISOString().split('T')[0] });
        setShow(false); setEditId(null); onUpdate();
      };
      const edit = (ex) => { setForm({amount:ex.amount,description:ex.description,category_id:ex.category_id,date:ex.date}); setEditId(ex.id); setShow(true); };
      const del = async (id) => { if(confirm('Delete this expense?')){ await supabase.from('expenses').delete().eq('id',id); onUpdate(); } };

      const filtered = expenses.filter(e=>{
        const d=new Date(e.date);
        return (filterYear==='all'||d.getFullYear().toString()===filterYear) && (filterMonth==='all'||d.getMonth().toString()===filterMonth);
      });
      const total = filtered.reduce((s,e)=>s+parseFloat(e.amount),0);

      return (
        <div className="page">
          <div className="page-header" style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <div>
              <div className="page-title">üí∏ Expenses</div>
              <div className="page-sub">{filtered.length} records ¬∑ Total: ‚Çπ{total.toFixed(2)}</div>
            </div>
            <button className="btn-add btn-add-blue" onClick={()=>{setShow(!show);setEditId(null);setForm({amount:'',description:'',category_id:'',date:new Date().toISOString().split('T')[0]});}}>
              {show?'‚úï Cancel':'+ Add Expense'}
            </button>
          </div>

          {show && (
            <div className="form-panel">
              <div className="form-panel-title">üí∏ {editId?'Edit':'New'} Expense</div>
              <form onSubmit={submit}>
                <div className="form-grid">
                  <div className="form-group2">
                    <label className="form-label2">Amount (‚Çπ) *</label>
                    <input className="form-input2" type="number" step="0.01" placeholder="0.00" value={form.amount} onChange={e=>setForm({...form,amount:e.target.value})} required />
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Category *</label>
                    <select className="form-input2" value={form.category_id} onChange={e=>setForm({...form,category_id:e.target.value})} required>
                      <option value="">Select category...</option>
                      {categories.map(c=><option key={c.id} value={c.id}>{c.icon} {c.name}</option>)}
                    </select>
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Description *</label>
                    <input className="form-input2" type="text" placeholder="What did you spend on?" value={form.description} onChange={e=>setForm({...form,description:e.target.value})} required />
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Date *</label>
                    <input className="form-input2" type="date" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} required />
                  </div>
                </div>
                <div className="form-actions">
                  <button className="btn-submit btn-blue" type="submit">{editId?'Update':'Add Expense'}</button>
                  <button className="btn-cancel" type="button" onClick={()=>setShow(false)}>Cancel</button>
                </div>
              </form>
            </div>
          )}

          <div className="table-card">
            <div className="filter-bar">
              <select className="filter-select" value={filterYear} onChange={e=>setFilterYear(e.target.value)}>
                <option value="all">All Years</option>
                {[2024,2025,2026].map(y=><option key={y} value={y}>{y}</option>)}
              </select>
              <select className="filter-select" value={filterMonth} onChange={e=>setFilterMonth(e.target.value)}>
                <option value="all">All Months</option>
                {['January','February','March','April','May','June','July','August','September','October','November','December'].map((m,i)=><option key={i} value={i}>{m}</option>)}
              </select>
            </div>
            <div className="table-wrap">
              {filtered.length===0 ? (
                <div className="empty-state"><div className="empty-icon">üí∏</div><div className="empty-text">No expenses found</div><div className="empty-sub">Try changing filters or add a new expense</div></div>
              ) : (
                <table>
                  <thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead>
                  <tbody>
                    {filtered.map(e=>(
                      <tr key={e.id}>
                        <td style={{color:'var(--text2)'}}>{new Date(e.date).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})}</td>
                        <td><span className="pill" style={{background:`${e.categories?.color||'#6B7280'}18`,color:e.categories?.color||'#6B7280'}}>{e.categories?.icon} {e.categories?.name||'‚Äî'}</span></td>
                        <td style={{fontWeight:500}}>{e.description}</td>
                        <td><span style={{color:'var(--red)',fontWeight:700}}>‚Çπ{parseFloat(e.amount).toFixed(2)}</span></td>
                        <td><button className="action-btn edit-btn" onClick={()=>edit(e)}>‚úèÔ∏è Edit</button><button className="action-btn del-btn" onClick={()=>del(e.id)}>üóëÔ∏è</button></td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ INCOME TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function IncomeTab({ income, onUpdate, user }) {
      const [show, setShow] = useState(false);
      const [form, setForm] = useState({ amount:'', source:'', description:'', date: new Date().toISOString().split('T')[0] });
      const [editId, setEditId] = useState(null);

      const submit = async (e) => {
        e.preventDefault();
        if(editId) await supabase.from('income').update(form).eq('id',editId);
        else await supabase.from('income').insert({...form, user_id:user.id});
        setForm({ amount:'', source:'', description:'', date: new Date().toISOString().split('T')[0] });
        setShow(false); setEditId(null); onUpdate();
      };
      const edit = (i) => { setForm({amount:i.amount,source:i.source,description:i.description||'',date:i.date}); setEditId(i.id); setShow(true); };
      const del = async (id) => { if(confirm('Delete this income?')){ await supabase.from('income').delete().eq('id',id); onUpdate(); } };
      const total = income.reduce((s,i)=>s+parseFloat(i.amount),0);

      return (
        <div className="page">
          <div className="page-header" style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <div>
              <div className="page-title">üíµ Income</div>
              <div className="page-sub">{income.length} records ¬∑ Total: ‚Çπ{total.toFixed(2)}</div>
            </div>
            <button className="btn-add btn-add-green" onClick={()=>{setShow(!show);setEditId(null);setForm({amount:'',source:'',description:'',date:new Date().toISOString().split('T')[0]});}}>
              {show?'‚úï Cancel':'+ Add Income'}
            </button>
          </div>

          {show && (
            <div className="form-panel">
              <div className="form-panel-title">üíµ {editId?'Edit':'New'} Income</div>
              <form onSubmit={submit}>
                <div className="form-grid">
                  <div className="form-group2">
                    <label className="form-label2">Amount (‚Çπ) *</label>
                    <input className="form-input2" type="number" step="0.01" placeholder="0.00" value={form.amount} onChange={e=>setForm({...form,amount:e.target.value})} required />
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Source *</label>
                    <input className="form-input2" type="text" placeholder="Salary, Pocket Money, Gift..." value={form.source} onChange={e=>setForm({...form,source:e.target.value})} required />
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Description (optional)</label>
                    <input className="form-input2" type="text" placeholder="Additional notes..." value={form.description} onChange={e=>setForm({...form,description:e.target.value})} />
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Date *</label>
                    <input className="form-input2" type="date" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} required />
                  </div>
                </div>
                <div className="form-actions">
                  <button className="btn-submit btn-green" type="submit">{editId?'Update':'Add Income'}</button>
                  <button className="btn-cancel" type="button" onClick={()=>setShow(false)}>Cancel</button>
                </div>
              </form>
            </div>
          )}

          <div className="table-card">
            <div className="table-wrap">
              {income.length===0 ? (
                <div className="empty-state"><div className="empty-icon">üíµ</div><div className="empty-text">No income yet</div><div className="empty-sub">Add your first income or pocket money</div></div>
              ) : (
                <table>
                  <thead><tr><th>Date</th><th>Source</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead>
                  <tbody>
                    {income.map(i=>(
                      <tr key={i.id}>
                        <td style={{color:'var(--text2)'}}>{new Date(i.date).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})}</td>
                        <td><span className="pill" style={{background:'rgba(16,217,140,0.1)',color:'var(--green)'}}>{i.source}</span></td>
                        <td style={{color:'var(--text2)'}}>{i.description||'‚Äî'}</td>
                        <td><span style={{color:'var(--green)',fontWeight:700}}>+‚Çπ{parseFloat(i.amount).toFixed(2)}</span></td>
                        <td><button className="action-btn edit-btn" onClick={()=>edit(i)}>‚úèÔ∏è Edit</button><button className="action-btn del-btn" onClick={()=>del(i.id)}>üóëÔ∏è</button></td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ CATEGORIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function CategoriesTab({ categories, onUpdate, user }) {
      const [show, setShow] = useState(false);
      const [form, setForm] = useState({ name:'', icon:'üí∞', color:'#6c63ff' });
      const [editId, setEditId] = useState(null);
      const icons = ['üçî','üöó','üéÆ','üõçÔ∏è','üìÑ','üíä','üìö','üè†','‚úàÔ∏è','üé¨','üí∞','üé®','‚öΩ','üì±','‚òï','üçï'];

      const submit = async (e) => {
        e.preventDefault();
        if(editId) await supabase.from('categories').update(form).eq('id',editId);
        else await supabase.from('categories').insert({...form, user_id:user.id});
        setForm({name:'',icon:'üí∞',color:'#6c63ff'}); setShow(false); setEditId(null); onUpdate();
      };
      const edit = (c) => { setForm({name:c.name,icon:c.icon,color:c.color}); setEditId(c.id); setShow(true); };
      const del = async (id) => { if(confirm('Delete category?')){ await supabase.from('categories').delete().eq('id',id); onUpdate(); } };

      return (
        <div className="page">
          <div className="page-header" style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <div>
              <div className="page-title">üè∑Ô∏è Categories</div>
              <div className="page-sub">{categories.length} categories configured</div>
            </div>
            <button className="btn-add btn-add-purple" onClick={()=>{setShow(!show);setEditId(null);setForm({name:'',icon:'üí∞',color:'#6c63ff'});}}>
              {show?'‚úï Cancel':'+ Add Category'}
            </button>
          </div>

          {show && (
            <div className="form-panel">
              <div className="form-panel-title">üè∑Ô∏è {editId?'Edit':'New'} Category</div>
              <form onSubmit={submit}>
                <div className="form-grid">
                  <div className="form-group2">
                    <label className="form-label2">Name *</label>
                    <input className="form-input2" type="text" placeholder="e.g., Groceries" value={form.name} onChange={e=>setForm({...form,name:e.target.value})} required />
                  </div>
                  <div className="form-group2">
                    <label className="form-label2">Color *</label>
                    <input className="form-input2" type="color" value={form.color} onChange={e=>setForm({...form,color:e.target.value})} required style={{height:'44px',padding:'4px 8px',cursor:'pointer'}} />
                  </div>
                  <div className="form-group2" style={{gridColumn:'span 2'}}>
                    <label className="form-label2">Icon ‚Äî Selected: {form.icon}</label>
                    <div style={{display:'flex',flexWrap:'wrap',gap:'8px',marginTop:'4px'}}>
                      {icons.map(ic=>(
                        <button key={ic} type="button" onClick={()=>setForm({...form,icon:ic})}
                          style={{width:42,height:42,borderRadius:10,fontSize:20,border:form.icon===ic?'2px solid var(--accent)':'1.5px solid var(--border)',background:form.icon===ic?'rgba(108,99,255,0.15)':'var(--bg2)',cursor:'pointer',transition:'all 0.15s'}}>
                          {ic}
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
                <div className="form-actions">
                  <button className="btn-submit btn-blue" type="submit">{editId?'Update':'Add Category'}</button>
                  <button className="btn-cancel" type="button" onClick={()=>setShow(false)}>Cancel</button>
                </div>
              </form>
            </div>
          )}

          <div className="cat-grid">
            {categories.map(c=>(
              <div key={c.id} className="cat-card">
                <div className="cat-icon-big" style={{background:`${c.color}20`}}>{c.icon}</div>
                <div className="cat-info">
                  <div className="cat-name" style={{color:c.color}}>{c.name}</div>
                  <div className="cat-hex">{c.color}</div>
                </div>
                <div className="cat-actions">
                  <button className="action-btn edit-btn" onClick={()=>edit(c)}>‚úèÔ∏è</button>
                  <button className="action-btn del-btn" onClick={()=>del(c.id)}>üóëÔ∏è</button>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ STATISTICS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function Statistics({ expenses, income }) {
      const lineRef = useRef(null);
      const pieRef = useRef(null);
      const lineInst = useRef(null);
      const pieInst = useRef(null);

      const totalInc = income.reduce((s,i)=>s+parseFloat(i.amount),0);
      const totalExp = expenses.reduce((s,e)=>s+parseFloat(e.amount),0);
      const avgExp   = expenses.length>0?(totalExp/expenses.length):0;
      const maxExp   = expenses.length>0?Math.max(...expenses.map(e=>parseFloat(e.amount))):0;
      const savings  = totalInc>0?(((totalInc-totalExp)/totalInc)*100):0;

      const catMap={};
      expenses.forEach(e=>{
        const k=e.categories?.name||'Other';
        const c=e.categories?.color||'#6B7280';
        const ic=e.categories?.icon||'üí∞';
        if(!catMap[k]) catMap[k]={amount:0,count:0,color:c,icon:ic};
        catMap[k].amount+=parseFloat(e.amount);
        catMap[k].count++;
      });
      const sortedCats=Object.entries(catMap).sort((a,b)=>b[1].amount-a[1].amount);

      useEffect(()=>{
        if(lineRef.current){
          if(lineInst.current) lineInst.current.destroy();
          const months=[]; const expD=[]; const incD=[];
          for(let i=11;i>=0;i--){
            const d=new Date(); d.setMonth(d.getMonth()-i);
            months.push(d.toLocaleString('default',{month:'short'}));
            expD.push(expenses.filter(e=>{ const ed=new Date(e.date); return ed.getMonth()===d.getMonth()&&ed.getFullYear()===d.getFullYear(); }).reduce((s,e)=>s+parseFloat(e.amount),0));
            incD.push(income.filter(i2=>{ const id=new Date(i2.date); return id.getMonth()===d.getMonth()&&id.getFullYear()===d.getFullYear(); }).reduce((s,i2)=>s+parseFloat(i2.amount),0));
          }
          lineInst.current = new Chart(lineRef.current,{
            type:'bar',
            data:{labels:months,datasets:[
              {label:'Income',data:incD,backgroundColor:'rgba(16,217,140,0.65)',borderRadius:6,borderSkipped:false},
              {label:'Expenses',data:expD,backgroundColor:'rgba(255,92,124,0.65)',borderRadius:6,borderSkipped:false}
            ]},
            options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:true,position:'top'}},scales:{x:{grid:{display:false}},y:{beginAtZero:true,grid:{color:'rgba(255,255,255,0.05)'}}}}
          });
        }
        return ()=>{ if(lineInst.current) lineInst.current.destroy(); };
      },[expenses,income]);

      useEffect(()=>{
        if(pieRef.current&&expenses.length>0){
          if(pieInst.current) pieInst.current.destroy();
          const labs=sortedCats.map(([k])=>k);
          const vals=sortedCats.map(([,v])=>v.amount);
          const cols=sortedCats.map(([,v])=>v.color);
          pieInst.current = new Chart(pieRef.current,{
            type:'doughnut',
            data:{labels:labs,datasets:[{data:vals,backgroundColor:cols,borderWidth:0,hoverOffset:8}]},
            options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{boxWidth:12,padding:16}}},cutout:'65%'}
          });
        }
        return ()=>{ if(pieInst.current) pieInst.current.destroy(); };
      },[expenses]);

      return (
        <div className="page">
          <div className="page-header">
            <div className="page-title">üìä Statistics</div>
            <div className="page-sub">Detailed financial analytics & insights</div>
          </div>

          <div className="stats-page-grid" style={{gridTemplateColumns:'repeat(4,1fr)',marginBottom:'24px'}}>
            {[
              {label:'Total Transactions',val:expenses.length+income.length,color:'var(--accent2)'},
              {label:'Avg. Expense',val:`‚Çπ${avgExp.toFixed(0)}`,color:'var(--red)'},
              {label:'Highest Expense',val:`‚Çπ${maxExp.toFixed(0)}`,color:'var(--orange)'},
              {label:'Savings Rate',val:`${savings.toFixed(1)}%`,color:'var(--green)'},
            ].map((s,i)=>(
              <div key={i} className="stat-mini" style={{animationDelay:`${i*80}ms`}}>
                <div className="stat-mini-label">{s.label}</div>
                <div className="stat-mini-val" style={{color:s.color}}>{s.val}</div>
              </div>
            ))}
          </div>

          <div className="charts-grid" style={{marginBottom:'24px'}}>
            <div className="chart-card">
              <div className="chart-title">12-Month Overview</div>
              <div className="chart-sub">Income vs Expenses bar comparison</div>
              <div className="chart-wrap"><canvas ref={lineRef}></canvas></div>
            </div>
            <div className="chart-card">
              <div className="chart-title">Category Distribution</div>
              <div className="chart-sub">Spending breakdown by category</div>
              <div className="chart-wrap">
                {expenses.length>0?<canvas ref={pieRef}></canvas>:<div className="empty-state"><div className="empty-icon">üìä</div><div className="empty-text">No data yet</div></div>}
              </div>
            </div>
          </div>

          <div className="table-card" style={{borderRadius:20}}>
            <div className="table-header">
              <div style={{fontSize:15,fontWeight:700}}>Category Breakdown</div>
            </div>
            <div style={{padding:'8px 24px 16px'}}>
              {sortedCats.length===0 ? (
                <div className="empty-state"><div className="empty-icon">üè∑Ô∏è</div><div className="empty-text">No data yet</div></div>
              ) : sortedCats.map(([name,s])=>(
                <div key={name} className="breakdown-item">
                  <div className="breakdown-icon" style={{background:`${s.color}18`}}>{s.icon}</div>
                  <div className="breakdown-info">
                    <div className="breakdown-name" style={{color:s.color}}>{name} <span style={{color:'var(--text3)',fontWeight:400,fontSize:12}}>({s.count} txns)</span></div>
                    <div className="breakdown-bar-wrap"><div className="breakdown-bar" style={{width:`${(s.amount/totalExp)*100}%`,background:s.color}}></div></div>
                  </div>
                  <div>
                    <div className="breakdown-amount" style={{color:'var(--red)'}}>‚Çπ{s.amount.toFixed(0)}</div>
                    <div className="breakdown-pct">{((s.amount/totalExp)*100).toFixed(1)}%</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function App() {
      const [user,   setUser]       = useState(null);
      const [loading,setLoading]    = useState(true);
      const [tab,    setTab]        = useState('dashboard');
      const [expenses,setExpenses]  = useState([]);
      const [income,  setIncome]    = useState([]);
      const [categories,setCats]    = useState([]);
      const [dark,   setDark]       = useState(true);

      useEffect(()=>{ checkUser(); },[]);
      useEffect(()=>{ if(user) loadAll(); },[user]);
      useEffect(()=>{ document.body.className=dark?'':'light'; },[dark]);

      const checkUser=async()=>{ const{data:{session}}=await supabase.auth.getSession(); setUser(session?.user??null); setLoading(false); };
      const loadAll=()=>Promise.all([loadExp(),loadInc(),loadCats()]);

      const loadExp=async()=>{ const{data}=await supabase.from('expenses').select('*,categories(name,color,icon)').order('date',{ascending:false}); setExpenses(data||[]); };
      const loadInc=async()=>{ const{data}=await supabase.from('income').select('*').order('date',{ascending:false}); setIncome(data||[]); };
      const loadCats=async()=>{
        const{data}=await supabase.from('categories').select('*').order('name');
        if(data&&data.length>0){ setCats(data); }
        else {
          const defaults=[
            {name:'Food',icon:'üçî',color:'#EF4444'},{name:'Transport',icon:'üöó',color:'#3B82F6'},
            {name:'Entertainment',icon:'üéÆ',color:'#8B5CF6'},{name:'Shopping',icon:'üõçÔ∏è',color:'#EC4899'},
            {name:'Bills',icon:'üìÑ',color:'#F59E0B'},{name:'Health',icon:'üíä',color:'#10B981'},
            {name:'Education',icon:'üìö',color:'#6366F1'},{name:'Others',icon:'üí∞',color:'#6B7280'}
          ];
          for(const c of defaults) await supabase.from('categories').insert({user_id:user.id,...c});
          loadCats();
        }
      };

      const logout=async()=>{ await supabase.auth.signOut(); setUser(null); };

      if(loading) return <div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh',fontSize:20,color:'var(--text2)'}}>Loading...</div>;
      if(!user)   return <AuthForm onSuccess={setUser} />;

      const email=user.email||'';
      const initials=email.substring(0,2).toUpperCase();
      const today=new Date().toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'long',year:'numeric'});

      const navItems=[
        {id:'dashboard',icon:'‚ö°',label:'Dashboard'},
        {id:'income',   icon:'üíµ',label:'Income'},
        {id:'expenses', icon:'üí∏',label:'Expenses'},
        {id:'categories',icon:'üè∑Ô∏è',label:'Categories'},
        {id:'statistics',icon:'üìä',label:'Statistics'},
      ];

      return (
        <div className="app-layout">
          {/* Sidebar */}
          <aside className="sidebar">
            <div className="sidebar-logo">
              <div className="sidebar-logo-icon">üí∞</div>
              <div>
                <div className="sidebar-logo-text">Expense</div>
                <div className="sidebar-logo-sub">Manager Pro</div>
              </div>
            </div>
            <div className="nav-label">Main Menu</div>
            {navItems.map(n=>(
              <button key={n.id} className={`nav-item ${tab===n.id?'active':''}`} onClick={()=>setTab(n.id)}>
                <span className="nav-icon">{n.icon}</span>
                {n.label}
              </button>
            ))}
            <div className="sidebar-bottom">
              <div className="user-card">
                <div className="user-avatar">{initials}</div>
                <div>
                  <div className="user-name">{initials}</div>
                  <div className="user-email">{email}</div>
                </div>
              </div>
              <button className="btn-logout" onClick={logout}>üö™ Sign Out</button>
            </div>
          </aside>

          {/* Main */}
          <div className="main-content">
            <div className="topbar">
              <div>
                <div className="topbar-greeting">Hi {initials} üëã</div>
                <div className="topbar-date">{today}</div>
              </div>
              <div className="topbar-right">
                <button className="notif-btn"><span>üîî</span><div className="notif-dot"></div></button>
                <button className="dark-toggle" onClick={()=>setDark(!dark)}>{dark?'‚òÄÔ∏è':'üåô'}</button>
              </div>
            </div>

            {tab==='dashboard'  && <Dashboard   expenses={expenses} income={income} dark={dark} setTab={setTab} />}
            {tab==='expenses'   && <ExpensesTab expenses={expenses} categories={categories} onUpdate={loadExp} user={user} />}
            {tab==='income'     && <IncomeTab   income={income} onUpdate={loadInc} user={user} />}
            {tab==='categories' && <CategoriesTab categories={categories} onUpdate={loadCats} user={user} />}
            {tab==='statistics' && <Statistics  expenses={expenses} income={income} />}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
